function showAddTel(e){$("#we_name").html(e),$(".login_mask").fadeIn(300),$(".login_mains").addClass("login_bounceIn").fadeIn()}function hideAddTel(){$(".login_mains").removeClass("login_bounceIn"),$(".login_mains").fadeOut(),$(".login_mask").fadeOut(),location.reload()}function showLogin(e,t,n){checkStatus=!1;var o,a;switch(e){case"zc":o="\u624b\u673a\u53f7\u6ce8\u518c",a="\u771f\u4e8c\u7f51\u627f\u8bfa\u4fdd\u62a4\u60a8\u7684\u9690\u79c1\u5b89\u5168";break;case"dl":o="\u624b\u673a\u5feb\u901f\u767b\u5f55",a="\u65e0\u8d26\u53f7\u81ea\u52a8\u6ce8\u518c\uff0c\u4e0d\u4f1a\u5bfc\u81f4\u624b\u673a\u53f7\u88ab\u6cc4\u9732";break;case"fav":o="\u624b\u673a\u5feb\u901f\u767b\u5f55",a="\u6536\u85cf\u8bf7\u5148\u767b\u5f55\uff0c\u65e0\u8d26\u53f7\u81ea\u52a8\u6ce8\u518c\uff0c\u4e0d\u4f1a\u5bfc\u81f4\u624b\u673a\u53f7\u88ab\u6cc4\u9732";break;case"chat":o="\u624b\u673a\u5feb\u901f\u767b\u5f55",a="\u804a\u5929\u8bf7\u5148\u767b\u5f55\uff0c\u65e0\u8d26\u53f7\u81ea\u52a8\u6ce8\u518c\uff0c\u4e0d\u4f1a\u5bfc\u81f4\u624b\u673a\u53f7\u88ab\u6cc4\u9732";break;case"follow":o="\u624b\u673a\u5feb\u901f\u767b\u5f55",a="\u5173\u6ce8\u8bf7\u5148\u767b\u5f55\uff0c\u65e0\u8d26\u53f7\u81ea\u52a8\u6ce8\u518c\uff0c\u4e0d\u4f1a\u5bfc\u81f4\u624b\u673a\u53f7\u88ab\u6cc4\u9732";break;case"agent":o="\u624b\u673a\u5feb\u901f\u767b\u5f55",a="\u8bf7\u767b\u5f55\u540e\u67e5\u770b\u6240\u6709";break;default:o="\u624b\u673a\u5feb\u901f\u767b\u5f55",a="\u65e0\u8d26\u53f7\u81ea\u52a8\u6ce8\u518c\uff0c\u4e0d\u4f1a\u5bfc\u81f4\u624b\u673a\u53f7\u88ab\u6cc4\u9732"}$(".tel_title").html(o),$(".tel_tips").html(a),$(".login_mask").fadeIn(300),$(".login_main").addClass("login_bounceIn").fadeIn(),popupTrack(),addCode(),referrerHref=n,loginCallback=t}function hideLogin(){referrerHref="",loginCallback=null,$(".login_main").removeClass("login_bounceIn"),$(".login_main").fadeOut(),$(".login_mask").fadeOut(),$(".login_tel").val(""),$(".login_code").val(""),checkStatus=!0,addCodeState=!1}function addTrack(e,t){window._vds&&_vds.track("zhuce",{type:e,uid:t})}function popupTrack(){window._vds&&_vds.track("web_register_popup")}function sendPhone(e){$.ajax({type:"post",url:"/oauth/send",dataType:"json",data:{telephone:e},success:function(e){0==e.code?(countTime=e.interal,beginCount()):alert(e.msg)},error:function(e){alert("\u7f51\u7edc\u9519\u8bef,\u8bf7\u7a0d\u540e\u518d\u8bd5")}})}function sendPricePhone(e){$.ajax({type:"post",url:"/oauth/send",dataType:"json",data:{telephone:e},success:function(e){0==e.code?(countPriceTime=e.interal,beginPriceCount()):alert(e.msg)},error:function(e){alert("\u7f51\u7edc\u9519\u8bef,\u8bf7\u7a0d\u540e\u518d\u8bd5")}})}function loginSuccessCb(e){loginCallback=null,e["new"]&&addTrack("phone",e.user_id),referrerHref?location.href=referrerHref:location.reload()}function signPriceIn(e,t){$.ajax({type:"post",url:"/oauth/verify",dataType:"json",data:{telephone:e,code:t},success:function(e){0==e.code?loginCallback?loginCallback(e,function(){loginSuccessCb(e)}):loginSuccessCb(e):2==e.code?$.utils.alert({content:"\u8be5\u624b\u673a\u53f7\u5df2\u7ecf\u6ce8\u518c\uff0c\u662f\u5426\u5408\u5e76\u8d26\u53f7\uff1f",type:"confirm",confirmText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onConfirm:function(){merge(e.token)}}):alert(e.msg),priceVerify=!1},error:function(e){alert("\u7f51\u7edc\u9519\u8bef,\u8bf7\u7a0d\u540e\u518d\u8bd5"),priceVerify=!1}})}function signIn(e,t){$.ajax({type:"post",url:"/oauth/verify",dataType:"json",data:{telephone:e,code:t},success:function(e){0==e.code?loginCallback?loginCallback(e,function(){loginSuccessCb(e)}):loginSuccessCb(e):alert(e.msg),verify=!1},error:function(e){alert("\u7f51\u7edc\u9519\u8bef,\u8bf7\u7a0d\u540e\u518d\u8bd5"),verify=!1}})}function phoneReg(e){var t=/^1[3456789]{1}[0-9]{9}$/;return e.length<1?(alert("\u624b\u673a\u53f7\u4e0d\u80fd\u4e3a\u7a7a"),!1):t.test(e)?!0:(alert("\u624b\u673a\u53f7\u683c\u5f0f\u586b\u5199\u9519\u8bef"),!1)}function beginCount(){getMsgDom.html(countTime--+"s\u540e\u91cd\u65b0\u53d1\u9001"),getMsgDom.addClass("disable");var e=setInterval(function(){getMsgDom.html(countTime--+"s\u540e\u91cd\u65b0\u53d1\u9001"),0>=countTime&&(getMsgDom.html("\u91cd\u65b0\u83b7\u53d6"),getMsgDom.removeClass("disable"),clearInterval(e))},1e3)}function beginPriceCount(){getPriceMsgDom.html(countPriceTime--+"s\u540e\u91cd\u65b0\u53d1\u9001"),getPriceMsgDom.addClass("disable");var e=setInterval(function(){getPriceMsgDom.html(countPriceTime--+"s\u540e\u91cd\u65b0\u53d1\u9001"),0>=countPriceTime&&(getPriceMsgDom.html("\u91cd\u65b0\u83b7\u53d6"),getPriceMsgDom.removeClass("disable"),clearInterval(e))},1e3)}function merge(e){$.ajax({type:"post",url:"/user/telephone/merge",dataType:"json",data:{token:e},success:function(e){1==e.state?$.utils.alert("\u5408\u5e76\u6210\u529f\uff0c\u9875\u9762\u5373\u5c06\u5237\u65b0"):$.utils.alert(e.msg),location.reload()},error:function(e){$.utils.alert("\u7f51\u7edc\u9519\u8bef,\u8bf7\u7a0d\u540e\u518d\u8bd5")}})}function addCode(){addCodeState||(addCodeState=!0,$.ajax({type:"post",dataType:"json",url:"/oauth/state/",success:function(e){function t(){var e=!1;l.removeClass("disable").text("\u6211\u5df2\u5173\u6ce8\uff0c\u5b8c\u6210\u767b\u5f55").click(function(){e||(e=!0,l.text("\u6b63\u5728\u68c0\u67e5\u5173\u6ce8\u72b6\u6001..."),s().then(function(e){e.subscribe?i():alert("\u8bf7\u5148\u5173\u6ce8\u201c\u771f\u4e8c\u7f51\u201d\uff01")}).always(function(){e=!1,l.text("\u6211\u5df2\u5173\u6ce8\uff0c\u5b8c\u6210\u767b\u5f55")}))})}if(0==e.code){$("#bound-code").empty(),state=e.state;var n=""+state+"#wechat_redirect";if(state){var o=new QRCode("bound-code",{text:url+n,width:200,height:200,colorDark:"#424345",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.L}),a=function(){return $.ajax({url:"/oauth/refresh",cache:!1,dataType:"json"}).then(function(e){state=e.state;var t=""+state+"#wechat_redirect";o.clear(),o.makeCode(url+t),state=e.state})},i=function(){location.reload()},c=function(){return $.ajax({url:"/oauth/checkstate/"+state,cache:!1,dataType:"json"}).then(function(e){switch(e.code){case 0:return 1===e["new"]&&addTrack("wechat",e.user_id),"0"==e.is_telephone_valid?(hideLogin(),showAddTel(e.nickname)):i(),$.Deferred().reject();case 1:a();break;case 2:break;case 3:$("#scan").hide(),$("#subscribe").show(),d=u;break;default:return $.Deferred().reject()}})},r=0,l=$("#subscribe-btn"),s=function(){return $.ajax({url:"/oauth/subscribe/"+state,cache:!1,dataType:"json"})},u=function(){return r++,s().then(function(e){switch(e.subscribe){case 1:return i(),$.Deferred().reject();case-1:alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u65b0\u626b\u7801\u767b\u5f55"),location.reload();break;default:if(r>=20)return t(),$.Deferred().reject()}})},d=c,f=1,g=function(){100>=f&&!checkStatus&&setTimeout(function(){d().then(g)},3e3),f++};g()}}},error:function(e){}}))}$.utils||($.utils={}),$.utils=$.extend(jQuery.utils,{showLoginMain:function(e,t,n){showLogin(e,t,n)}}),$(".change_login_btn_list").on("click","span",function(){var e=$(this),t=e.attr("data-class"),n=$(".login_content");e.addClass("active").siblings().removeClass("active"),n.hide(),$("."+t).show()});var loginCallback=null,addCodeState=!1,checkStatus=!1,referrerHref;$(".login_ico").on("click",function(e){if(!user_id){e.stopPropagation(),e.preventDefault();var t=$(this),n=t.attr("data-loginType");referrerHref=t.attr("href"),showLogin(n)}}),$(".login_close_btn").on("click",function(){hideLogin()}),$(".add_tel_close_btn").on("click",function(){hideAddTel()}),$(".login_mask").on("click",function(){hideLogin(),hideAddTel()});var state,verify=!1,getMsgDom=$(".get_code"),loginDom=$(".login_btn");getMsgDom.on("click",function(){if(!getMsgDom.hasClass("disable")){var e=$(".login_tel").val(),t=phoneReg(e);t&&sendPhone(e)}});var countTime=0;loginDom.on("click",function(){var e=$(".login_tel").val(),t=$(".login_code").val();if(!verify){var n=phoneReg(e);n&&t&&(verify=!0,signIn(e,t))}});var countPriceTime=0,priceVerify=!1,getPriceMsgDom=$(".add_tel_get_code"),loginPriceDom=$(".add_tel_login_btn");getPriceMsgDom.on("click",function(){if(!getPriceMsgDom.hasClass("disable")){var e=$(".add_tel_tel").val(),t=phoneReg(e);t&&sendPricePhone(e)}}),loginPriceDom.on("click",function(){var e=$(".add_tel_tel").val(),t=$(".add_tel_tel_code").val();if(!priceVerify){var n=phoneReg(e);n&&t&&(priceVerify=!0,signPriceIn(e,t))}});