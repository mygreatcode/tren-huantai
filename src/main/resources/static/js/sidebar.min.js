require(["https://static.zhen22.com/pub-js/buy_tool.js?3"],function(e){function t(e){var t,a=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(a))?unescape(t[2]):null}function a(e,t,a){var n=new Date;n.setHours(n.getHours()+a),document.cookie=e+"="+escape(t)+(null==a?"":";expires="+n.toGMTString())+";path=/"}function n(e,t){$.ajax({type:"POST",url:e,data:t,dataType:"json",success:function(e){0==e.code?$("body").trigger("sidebar.dataChange","fav"):alert(e.msg)},error:function(e,t,a){alert("\u7cfb\u7edf\u5fd9\uff0c\u8bf7\u7a0d\u540e")}})}function o(e){for(var t=0;t<e.length;t++)$(".contrast_"+e[t]).addClass("contrasted").html("\u5df2\u52a0\u5165\u5bf9\u6bd4")}function s(e){$(".contrast_"+e).removeClass("contrasted").html("\u52a0\u5165\u5bf9\u6bd4")}function r(e,t){for(var n=0;n<t.length;n++)if(t[n]==e){t.splice(n,1);break}G.contrast.num=t.length,$.utils.contrastNum=t.length;var o=t.join("-");a("contrast_"+currentCity,o),s(e),$("body").trigger("sidebar.dataChange","contrast")}function i(e){var t=localStorage.chats_time?JSON.parse(localStorage.chats_time):{},a=(new Date).getTime(),n=!0;return t[e]&&(n=a-parseInt(t[e])>72e5),t[e]=a,localStorage.chats_time=JSON.stringify(t),n}function c(e){return e?e.replace(/^http.*?:/,""):"/a/desktop.desktop/a/public/default-house-big.jpg"}function u(){H&&clearTimeout(H),H=setTimeout(function(){G.buy_tool.loan.calc()},50)}function l(){G.buy_tool.taxe.calc()}function d(){var t={1:"7\u6298",2:"75\u6298",3:"8\u6298",4:"85\u6298",5:"88\u6298",6:"9\u6298",7:"95\u6298",8:"\u57fa\u51c6",9:"1.05\u500d",10:"1.1\u500d",11:"1.15\u500d",12:"1.2\u500d",13:"1.25\u500d",14:"1.3\u500d",15:"1.35\u500d",16:"1.4\u500d"},a={rate_year:G.buy_tool.loan.data.sd_rate.split("-")[0],type:G.buy_tool.loan.data.type,year:G.buy_tool.loan.data.year,"float":t[G.buy_tool.loan.data.sd_rate.split("-")[1]]},n={rate_year:G.buy_tool.loan.data.found_rate.split("-")[0],type:G.buy_tool.loan.data.type,year:G.buy_tool.loan.data.year,"float":t[G.buy_tool.loan.data.found_rate.split("-")[1]]},o=100*e.loan.getRate($.extend({},a,{type:"\u5546\u8d37"})),s=100*e.loan.getRate($.extend({},n,{type:"\u516c\u79ef\u91d1"}));o=Math.round(1e3*o)/1e3,s=Math.round(1e3*s)/1e3,O&&o==O.sd_rate&&s==O.fund_rate||(O={sd_rate:o,fund_rate:s},G.buy_tool.loan.rate.sd_rate=o,G.buy_tool.loan.rate.fund_rate=s),u()}function m(){$("html,body").on("click",function(e){G.opening=!1}),$("body").on("sidebar.dataChange",function(e,t){G.init(t)})}function p(e,t){sessionStorage.setItem(currentCity+"_chat",e.house),t&&t()}function f(e){webim.setJsonpLastRspData(e)}function g(){var e=user_id;e&&$.ajax({url:"/"+currentCity+"/chat/genSig",data:{identifier:e},type:"POST",dataType:"json",success:function(t){setTimeout(function(){1==t.code&&(Q.userSing=t.data,z={sdkAppID:Q.appSdkId,appIDAt3rd:Q.appSdkId,accountType:Q.accountType,identifier:e,userSig:Q.userSing?Q.userSing:sig,headurl:"/asset/a/face.jpg"},h(),$("ul.logIm").length>0&&b("logIm",Q.limit,Q.offset))},100)},error:function(e){}})}function h(){webim.init(z,X,null),Q.login=!0}function _(e){var t;webim.MsgStore.sessMap();for(var a in e)t=e[a],t.sess._impl.id==Q.selToID&&(Q.selSess=t.sess,T(t));webim.setAutoRead(Q.selSess,!0,!0)}function y(e,t){if(0==e)return e;t=t||"MM\u6708dd\u65e5 hh:mm";var a=new Date(1e3*e),n={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in n)new RegExp("("+o+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[o]:("00"+n[o]).substr((""+n[o]).length)));return t}function v(e,t){if(0==e)return e;t=t||"MM\u6708dd\u65e5 hh:mm";var a=new Date(1e3*e),n={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in n)new RegExp("("+o+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[o]:("00"+n[o]).substr((""+n[o]).length)));return t=n["h+"]<=12?t.replace(/\d+[\u4e00-\u9fa5]\d+[\u4e00-\u9fa5]/g,"\u4e0a\u5348"):t.replace(/\d+[\u4e00-\u9fa5]\d+[\u4e00-\u9fa5]/g,"\u4e0b\u5348")}function b(e,t,a){if(G.groupListData=[],"logIm"==e){var n=document.getElementsByClassName(""+e)[0];n.innerHTML=""}Q.userFace={},$.ajax({url:"/"+currentCity+"/chat/get_group_list",data:{limit:t?t:"",skip:a?a:""},type:"POST",dataType:"json",success:function(t){if(1==t.code){var a=t.data.group_list,n=[];for(var o in a){var s={},r=a[o];if(s.houseName=r.name,s.userName=1===r.user_type?r.to_account:r.from_account,s.userType=r.user_type,s.rooms=r.house.rooms,s.groupId=r.group_id,s.house_id=r.house.id,s.halls=r.house.halls,s.price=r.house.price,s.washrooms=r.house.washrooms,s.area=r.house.area,s.allData=r,s.faceUrl=r.face[r.to_account_id]?r.face[r.to_account_id]:"/a/desktop.desktop/a/public/default-face.jpg",r.last_message){s.time=v(r.last_message.create_time,"MM\u6708dd\u65e5 hh:mm");for(var i=new webim.Msg,o=0;o<r.last_message.message.length;o++){var c=r.last_message.message[o];if("TIMTextElem"==c.MsgType||"TIMTextElem"==c.type){var u=new webim.Msg.Elem.Text(c.MsgContent?c.MsgContent.Text:c.content.text);i.addText(u)}else{var l=c.content?c.content.data:c.MsgContent.Data,d=c.content?c.content.index:c.MsgContent.Index,m=webim.EmotionPicData[l];if(m){var p=new webim.Msg.Elem.Face(webim.EmotionPicDataIndex[d],l);i.addFace(p)}}s.text=i.toHtml()}}for(var f in r.face)Q.userFace[f]=r.face[f];"logIm"==e&&L(r.group_id,1==r.user_type?r.to_account:r.from_account,r.cover,"","sesslist-group",e,r),n.push(s)}G.groupListData=n,$("ul.logIm").length>0&&t.data.count>0&&D(t.data.count,Q.offset)}},error:function(e){}})}function C(e,t){return function(a,n){var o=a[e],s=n[e],r=a[t],i=n[t];return(0!=o||0!=s?o>s:r>i)?1:(0!=o||0!=s?s>o:i>r)?-1:0}}function x(e){var t=document.getElementsByClassName("sendMsg")[0];t.focus(),"\u8bf7\u8f93\u5165\u60a8\u7684\u95ee\u9898."==$("#send_msg_text").val()&&$("#send_msg_text").val(""),t.value+=e.id,S(["emotionBox"])}function T(e){var t=e.isSend?z.identifier:e.fromAccount,a=document.createElement("div");a.className="chat_user";var n=document.createElement("div");n.className="user_info";var o=document.createElement("div");o.className="user_face";var s=document.createElement("div");s.className="chat_content";var r=document.createElement("div");r.className="arrow";var i=document.createElement("div");i.className="text";var c=document.createElement("div");c.className="time";var u=document.createElement("img");u.src=Q.userFace[t]?Q.userFace[t].replace(/(https:\/\/)|(http:\/\/)/gi,"//"):"/a/desktop.desktop/a/public/default-face.jpg",u.onerror=function(){u.src="/a/desktop.desktop/a/public/default-face.jpg"},e.isSend&&a.classList.add("me"),c.innerHTML=y(e.time,"MM\u6708dd\u65e5 hh:mm"),i.innerHTML=e.toHtml(),o.appendChild(u),n.appendChild(o),s.appendChild(r),s.appendChild(i),s.appendChild(c),a.appendChild(n),a.appendChild(s);var l=document.getElementsByClassName("chat_panel_content")[0];$("div.chat_panel_content").length<1||(l.appendChild(a),setTimeout(function(){l.scrollTop=l.scrollHeight},300))}function M(e,t,a,n){return Q.selToID==t&&!$("div.chat_panel_content").length<1?!1:(Q.selToID=t,Q.curMsgCount=0,void("sesslist-group"==a&&(J==Q.SessionType.C2C&&(J=Q.SessionType.GROUP),Q.selSess=null,webim.MsgStore.delSessByTypeId(J,Q.selToID),G.chat.openChatPanel(n),w(n))))}function w(e){function t(o){var s={GroupId:e.group_id,ReqMsgSeq:o,ReqMsgNumber:20};webim.syncGroupMsgs(s,function(o){for(var s=0;s<o.length;s++)n.push(o[s].msg),a=o[0].msg.seq;20==o.length&&t(o[0].msg.seq-1),o.length<20&&N(n,a,e.group_id)})}var a,n=[];if(!e.last_message)return void t(0);var o=Math.round((new Date).getTime()/1e3);Math.abs(e.last_message.create_time-o)<604800?t(0):E(e.group_id)}function E(e){var t=[];$.ajax({url:"/"+currentCity+"/chat/get_oneGroup_message",data:{group_id:e},type:"POST",dataType:"json",success:function(a){if(1==a.code){for(var n in a.data){var o={},s=a.data[n];o.elems=s.message,o.time=s.create_time,o.seq=s.MsgSeq,o.fromAccount=s.user_id,t.push(o)}document.getElementsByClassName("chat_panel_content")[0].innerHTML=""}t.sort(C("seq","time"));for(var r=0;r<t.length;r++)k(t[r],e)},error:function(e){}})}function N(e,t,a){var n=e;$.ajax({url:"/"+currentCity+"/chat/get_oneGroup_message",data:{group_id:a,MsgSeq:t},type:"POST",dataType:"json",success:function(e){if(1==e.code)for(var t in e.data){var o={},s=e.data[t];o.elems=s.message,o.time=s.create_time,o.seq=s.MsgSeq,o.fromAccount=s.user_id,n.push(o)}document.getElementsByClassName("chat_panel_content")[0].innerHTML="",n.sort(C("seq","time"));for(var r=0;r<n.length;r++)k(n[r],a)},error:function(e){}})}function k(e,t){if(t==Q.selToID){var a=e.fromAccount==z.identifier?z.identifier:e.fromAccount,n=document.createElement("div");n.className="chat_user";var o=document.createElement("div");o.className="user_info";var s=document.createElement("div");s.className="user_face";var r=document.createElement("div");r.className="chatMain";var i=document.createElement("div");i.className="chat_content";var c=document.createElement("div");c.className="arrow";var u=document.createElement("div");u.className="text";var l=document.createElement("div");l.className="time";var d=document.createElement("img");d.src=Q.userFace[a]?Q.userFace[a].replace(/(https:\/\/)|(http:\/\/)/gi,"//"):"/a/desktop.desktop/a/public/default-face.jpg",d.onerror=function(){d.src="/a/desktop.desktop/a/public/default-face.jpg"},l.innerHTML=y(e.time,"MM\u6708dd\u65e5 hh:mm");for(var m=new webim.Msg,p=0;p<e.elems.length;p++){var f=e.elems[p];if("TIMTextElem"==f.MsgType||"TIMTextElem"==f.type){var g=new webim.Msg.Elem.Text(f.MsgContent?f.MsgContent.Text:f.content.text);m.addText(g)}else{var h=f.content?f.content.data:f.MsgContent.Data,_=f.content?f.content.index:f.MsgContent.Index,v=webim.EmotionPicData[h];if(v){var b=new webim.Msg.Elem.Face(webim.EmotionPicDataIndex[_],h);m.addFace(b)}}u.innerHTML=m.toHtml()}e.fromAccount==z.identifier&&n.classList.add("me"),n.appendChild(o),n.appendChild(r),s.appendChild(d),o.appendChild(s),i.appendChild(c),i.appendChild(u),i.appendChild(l),r.appendChild(i);var C=document.getElementsByClassName("chat_panel_content")[0];$("div.chat_panel_content").length<1||(C.appendChild(n),setTimeout(function(){C.scrollTop=C.scrollHeight},300))}}function L(e,t,a,n,o,s,r){var i=document.getElementsByClassName(""+s)[0],c=i.childNodes.length,u=document.createElement("li");u.id=s+"_"+e,u.className="chat_lists",u.onclick=function(){M(c,e,o,r)};var l=document.createElement("div");l.className="chat_dialog";var d=document.createElement("div");d.className="record-a",d.classList.add("fl");var m=document.createElement("div");m.className="record-con",m.classList.add("fl");var p=document.createElement("h5");p.className="record-name";var f=document.createElement("img");if(f.id="faceImg_"+e,f.className="face",f.src=a?a:"/a/desktop.desktop/a/public/default-face.jpg",f.onerror=function(){f.src="/a/desktop.desktop/a/public/default-face.jpg"},p.innerHTML=t,1==r.user_type&&u.classList.add("buyer"),d.appendChild(f),m.appendChild(p),l.appendChild(d),r.last_message){var g=document.createElement("div");r.last_message.user_id==user_id?g.className="answer":g.className="ask";var h=document.createElement("p"),_=document.createElement("i"),v=document.createElement("p"),b=document.createElement("span");v.className="record-time";for(var C=new webim.Msg,x=0;x<r.last_message.message.length;x++){var T=r.last_message.message[x];if("TIMTextElem"==T.MsgType){var w=new webim.Msg.Elem.Text(T.MsgContent.Text);C.addText(w)}else{var $=webim.EmotionPicData[T.MsgContent.Data];if($){var E=new webim.Msg.Elem.Face(webim.EmotionPicDataIndex[T.MsgContent.Index],T.MsgContent.Data);C.addFace(E)}}h.innerHTML=C.toHtml()}b.innerHTML=y(r.last_message.create_time,"MM\u6708dd\u65e5 hh:mm"),v.appendChild(b),g.appendChild(h),g.appendChild(_),m.appendChild(g),u.appendChild(v)}if(l.appendChild(m),u.appendChild(l),r.house.id){var N=document.createElement("p");if(N.className="relevant",N.innerHTML="\u76f8\u5173\u4fe1\u606f\uff1a",r.house.valid){var k=document.createElement("a");k.href="/"+currentCity+"/house/"+r.house.id,k.target="_blank",k.innerHTML=r.name}else{var k=document.createElement("span");k.innerHTML="\u5df2\u5220\u9664"}N.appendChild(k),u.appendChild(N)}i.appendChild(u)}function j(e){var t=e.GroupId,a=(e.GroupFaceUrl,e.GroupName);e.OwnerAccount,e.GroupNotification,e.GroupIntroduction;if(a){var n="nameDiv_"+t,o=document.getElementById(n);o&&(a.length>maxNameLen&&(a=a.substr(0,maxNameLen)+"..."),o.innerHTML=a)}}function I(e){for(var t in e)$("."+e[t]).addClass("active")}function S(e){for(var t in e)$("."+e[t]).removeClass("active")}function P(){var e=$("#send_msg_text");if(!Q.selToID)return alert("\u4f60\u8fd8\u6ca1\u6709\u597d\u53cb,\u4e0d\u80fd\u804a\u5929"),void e.val("");var t=e.val(),a=webim.Tool.getStrBytes(t);if(t.length<1||"\u8bf7\u8f93\u5165\u60a8\u7684\u95ee\u9898."==t)return alert("\u53d1\u9001\u7684\u6d88\u606f\u4e0d\u80fd\u4e3a\u7a7a"),e.val(""),void e.focus();var n,o;if(J==Q.SessionType.C2C?(n=Q.MaxMsgLen.C2C,o="\u6d88\u606f\u957f\u5ea6\u8d85\u51fa\u9650\u5236\uff08\u6700\u591a"+Math.round(n/3)+"\u6c49\u5b57\uff09"):(n=Q.MaxMsgLen.GROUP,o="\u6d88\u606f\u957f\u5ea6\u8d85\u51fa\u9650\u5236\uff08\u6700\u591a"+Math.round(n/3)+"\u6c49\u5b57\uff09"),a>n)return alert(o),void e.focus();Q.selSess||(Q.selSess=new webim.Session(J,Q.selToID,Q.selToID,Y,Math.round((new Date).getTime()/1e3)));var s=new webim.Msg(Q.selSess,!0),r=/\[[^[\]]{1,3}\]/gm,i=t.match(r);if(!i||i.length<1){var c=new webim.Msg.Elem.Text(t);s.addText(c)}else{for(var u=0;u<i.length;u++){var l=t.substring(0,t.indexOf(i[u]));if(l){var c=new webim.Msg.Elem.Text(l);s.addText(c)}var d=webim.EmotionPicData[i[u]];if(d){var m=new webim.Msg.Elem.Face(webim.EmotionPicDataIndex[i[u]],i[u]);s.addFace(m)}else{var c=new webim.Msg.Elem.Text(i[u]);s.addText(c)}var p=t.indexOf(i[u])+i[u].length;t=t.substring(p)}if(t){var c=new webim.Msg.Elem.Text(t);s.addText(c)}}webim.sendMsg(s,function(t){T(s),Q.curMsgCount++,e.val(""),e.blur()}),function(t){alert(t.ErrorInfo),e.val(""),e.blur()}}function D(e,t,a){var n=this;e=e?n.lastListTotal=e:n.lastListTotal;var o=12,s=[],r={},i=tpl.template('<li class="<%=status%>"><a href="javascript:void(0);" data-num="<%=num%>"><%=disNum%></a></li>'),c=tpl.template('<li class="<%=status%>"><span data-num="<%=num%>"><%=disNum%></span></li>'),u=parseInt(e/Q.limit)+1,l=parseInt(t/Q.limit)+1;1===l?s.push(c({status:"disabled",num:"",disNum:"\u4e0a\u4e00\u9875"})):s.push(i({status:"",num:1>l-1?1:l-1,disNum:"\u4e0a\u4e00\u9875"}));for(var d=1;u>=d;d++){if(r={status:"",num:d,disNum:d},u>o&&d>1&&u>d){if(d>2&&l-(o-3)/2>d||u-1>d&&d>l+(o-3)/2)continue;Math.abs(l-d)>1&&(2===d||d===u-1)&&(r.status="disabled",r.num="",r.disNum="...")}d===l&&(r.status="active"),s.push(i(r))}l===u?s.push(c({status:"disabled",num:"",disNum:"\u4e0b\u4e00\u9875"})):s.push(i({status:"",num:l+1>u?u:l+1,disNum:"\u4e0b\u4e00\u9875"})),$(".listPage ul").html(s.join(""))}function R(){K.removeClass("promotion-show").addClass("promotion-hide"),$(".download_tip").removeClass("promotion-btn-hide").addClass("promotion-btn-show")}var H,A="/a/desktop.desktop/a/sidebar",B="/a/desktop.desktop/a/wechat_code/",O=!1,F=$("html,body"),q=$("#rightFloat"),G=(q.find(".big"),t("notice_hide"),avalon.define({$id:"sidebar",opening:!1,inited:!1,floatPanel:!1,houseId:null,groupListData:null,unreadMsg:{customer:0,owner:0},current_data:null,current_agent:null,sidebarBtns:[{key:"evaluate",action:function(){location.href="/"+currentCity+"/evaluate"},text:"\u4f30\u623f\u4ef7",hide:"zz"!=currentCity},{key:"contrast",text:"\u623f\u6e90\u5bf9\u6bd4"},{key:"chat_log",text:"\u804a\u5929\u8bb0\u5f55",login:!0},{key:"fav_house",text:"\u6211\u7684\u6536\u85cf",login:!0},{key:"buy_tool",text:"\u8d2d\u623f\u5de5\u5177",hide:!e},{key:"app",type:"app",action:function(){},pic:B+"sidebar.png"},{key:"qrcode",type:"qrcode",action:function(){},pic:A+"/weChat_code.png"},{key:"go_top",action:function(){F.animate({scrollTop:0},300)},type:"top"}],user_id:user_id,my_user_id:user_id,newMsgCb:function(){var e=this;setTimeout(function(){e.scrollTop=e.scrollHeight},100)},buy_tool:{active:"loan",openTool:function(e){G.buy_tool.active=G.buy_tool.active==e?G.buy_tool.active:e},loan:{rateList:e?e.loan.list.list:[],data:{type:"\u5546\u8d37",calcType:1,singlePrice:"",businessPrice:"",afPrice:"",area:"",ratio:"7",price:"",year:"30",sd_rate:e?e.loan.list.def:"",found_rate:e?e.loan.list.def:"",sdRate:"",fundRate:"",refund:"1"},rate:{sd_rate:"",fund_rate:""},singleRate:"",result:{all:"",loanPrice:"",refund:"",interest:"",first:"",month:"",monthAverage:"",firstMouth:"",abc:""},setData:function(e){$.extend(G.buy_tool.loan.data,e)},reset:function(){var t={type:"\u5546\u8d37",calcType:1,singlePrice:"",businessPrice:"",afPrice:"",area:"",ratio:"7",price:"",year:"30",sd_rate:e?e.loan.list.def:"",found_rate:e?e.loan.list.def:"",refund:"1"};for(var a in t)t.hasOwnProperty(a)&&(G.buy_tool.loan.data[a]=t[a])},calc:function(){var t={total:1e4*G.buy_tool.loan.data.price,year:G.buy_tool.loan.data.year,first_pay:10-G.buy_tool.loan.data.ratio,repayment_method:"1"==G.buy_tool.loan.data.refund?"\u672c\u606f":"\u672c\u91d1",sd_rate:G.buy_tool.loan.rate.sd_rate/100,type:G.buy_tool.loan.data.type,sd_total:1e4*G.buy_tool.loan.data.businessPrice,fund_total:1e4*G.buy_tool.loan.data.afPrice,fund_rate:G.buy_tool.loan.rate.fund_rate/100};2==G.buy_tool.loan.data.calcType&&(t.dk_total=1e4*G.buy_tool.loan.data.price);var a=e.loan.calc(t);if(G.buy_tool.loan.result.all=a.zonge,G.buy_tool.loan.result.loanPrice=a.dk_total,G.buy_tool.loan.result.refund=a.allhk,G.buy_tool.loan.result.interest=a.interest,G.buy_tool.loan.result.first=a.first,G.buy_tool.loan.result.month=a.yhk,a.yhk&&"string"==typeof a.yhk){G.buy_tool.loan.result.monthAverage=a.yhk.split(" ");var n=/\d*\.\d*/gi,o=/\d*\.\d*/gi,s=n.exec(G.buy_tool.loan.result.monthAverage[0]),r=o.exec(G.buy_tool.loan.result.monthAverage[1]);G.buy_tool.loan.result.firstMouth=s,G.buy_tool.loan.result.abc=s-r}}},taxe:{data:{area:"",single:"",way:1,houseNum:1,year:2,nature:1,only:1,org:0},result:{deed:"",business:"",income:"",stamp:"",reg:"",poundage:"",all:""},reset:function(){var e={area:"",single:"",way:1,houseNum:1,year:2,nature:1,only:1,org:0};for(var t in e)e.hasOwnProperty(t)&&(G.buy_tool.taxe.data[t]=e[t])},calc:function(){var t={city:4101,area:G.buy_tool.taxe.data.area,total_price:G.buy_tool.taxe.data.area*G.buy_tool.taxe.data.single,buy_years:G.buy_tool.taxe.data.year,is_house:1,calc_type:1,original_price:G.buy_tool.taxe.data.org,houseNum:G.buy_tool.taxe.data.houseNum,is_only:G.buy_tool.taxe.data.only},a=e.taxe.calc(t);G.buy_tool.taxe.result.deed=a.qishui,G.buy_tool.taxe.result.business=a.yyshui,G.buy_tool.taxe.result.income=a.grsdshui,G.buy_tool.taxe.result.stamp=a.qzyhshui,G.buy_tool.taxe.result.reg=a.djfei,G.buy_tool.taxe.result.poundage=a.jysxfei,G.buy_tool.taxe.result.all=a.heji}}},chat:{listType:"buyer",chatList:[],chatMsgs:[],msgPanel:{},isBuyer:!1,writeMsg:"",sendMsging:!1,timer:setInterval(function(){},1e4),getUnread:function(){var e=$.utils.getCityUrl("/chat/unread");$.ajax({type:"get",dataType:"json",url:e,data:{t:(new Date).getTime()}}).success(function(e){0==e.code?(G.unreadMsg.customer!=e.data.customer||G.unreadMsg.owner!=e.data.owner)&&(G.unreadMsg.customer=e.data.customer,G.unreadMsg.owner=e.data.owner,G.chat.getList()):$.utils.alert(e.msg)}).error(function(){user_id=!1})},openChatPanel:function(e,t,a){G.chat.chatMsgs.splice(0,1,e);var n=e.house.id;G.houseId=n,G.current_data=e.house,e.house.valid&&(setTimeout(function(){$("#chat_userName").attr("href","/"+currentCity+"/house/"+e.house.id+"/")},100),setTimeout(function(){G.chat.autoReply("first")},1e3),e.agent?G.current_agent=e.agent:e.prospect_comment&&e.prospect_comment.id?G.current_agent=e.prospect_comment:e.claim_agent?G.current_agent=e.claim_agent:e.community_claim?G.current_agent=e.community_claim:G.current_agent=e.private_waiter)},changeListType:function(e){var t=$(e.target).data("type");G.chat.listType=t},getChatUser:function(e){for(var t={},a=0;a<e.length;a++)e[a].id==user_id?(t[e[a].id]=e[a],t[e[a].id].type="me",G.chat.isBuyer=1==e[a].role):(t[e[a].id]=e[a],t[e[a].id].type="other",e[a].headimgurl=c(e[a].headimgurl),t.other=e[a]);return t.other||(t.other={headimgurl:"/a/desktop.desktop/a/public/default-house-big.jpg",name:"\u7528\u6237\u5df2\u88ab\u62c9\u9ed1"}),t},sendMsg:function(e,t){if("keyup"==e.type){if(13!==e.keyCode)return}else e.preventDefault();G.chat.sendMsging=!0,$.ajax({type:"post",url:$.utils.getCityUrl("/chat/send"),dataType:"json",data:{chat_id:t,message:G.chat.writeMsg}}).success(function(e){0==e.code?G.chat.chatMsgs.length<1?$.utils.alert("\u804a\u5929\u5f02\u5e38,\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5."):(i(t)&&G.chat.isBuyer&&G.chat.chatMsgs[0].msgs.push({isTips:!0}),G.chat.writeMsg="",G.chat.chatMsgs[0].msgs.push(e.data)):$.utils.alert(e.msg),G.chat.sendMsging=!1}).error(function(e){G.chat.sendMsging=!1})},getList:function(){$.ajax({type:"post",url:"/"+currentCity+"/chat/log_"+G.chat.listType,dataType:"json"}).success(function(e){for(var t=0;t<e.data.logs.length;t++)e.data.logs[t].user=G.chat.getChatUser(e.data.logs[t].users),e.data.logs[t].house||(e.data.logs[t].house={status:-2,name:""});G.chat.chatList=e.data.logs}).error(function(e){user_id=!1})},getMsg:function(e,t,a,n){var o,s=e[t].chat_id,r={chat_id:s},i=e[t].msgs||[];(!G.chat.sendMsging||n)&&i&&i.length>0&&(a?(o=i[0].id,r.old=1):o=i[i.length-1].id,r.start_id=o)},autoReply:function(e){var t=G.current_data,a=$(".chat_panel_content")[0],n=G.current_agent;if("first"!=e)var o=$("#auto-reply-second").html();else var o=$("#auto-reply-first").html();var s="";switch(e){case"second":s=t.property_age>0?"\u8be5\u623f\u6e90\u4ea7\u6743\u5e74\u9650\u4e3a"+t.property_age+"\u5e74\uff0c\u66f4\u8be6\u7ec6\u7684\u4ea7\u6743\u4fe1\u606f\u53ef\u4ee5\u8054\u7cfb\u623f\u5c0f\u4e8c\u54a8\u8be2":"\u8be5\u623f\u6e90\u4ea7\u6743\u5e74\u9650\u6682\u65e0\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u8054\u7cfb\u623f\u5c0f\u4e8c\u54a8\u8be2\u8be6\u7ec6\u7684\u623f\u6e90\u4fe1\u606f";break;case"third":s=2==t.sold_years&&2==t.is_only?"\u8be5\u623f\u6e90\u7b26\u5408\u3010\u6ee1\u4e94\u552f\u4e00\u3011\u6761\u4ef6\uff0c\u66f4\u8be6\u7ec6\u7684\u7a0e\u8d39\u4fe1\u606f\u53ef\u4ee5\u8054\u7cfb\u623f\u5c0f\u4e8c\u54a8\u8be2":"\u8be5\u623f\u6e90\u4e0d\u7b26\u5408\u6216\u672a\u77e5\u662f\u5426\u7b26\u5408\u3010\u6ee1\u4e94\u552f\u4e00\u3011\u6761\u4ef6\uff0c\u4f60\u53ef\u4ee5\u8054\u7cfb\u623f\u5c0f\u4e8c\u54a8\u8be2\u8be6\u7ec6\u7684\u623f\u6e90\u4fe1\u606f";break;case"fourth":s=1==t.accept_mortgage?"\u8be5\u623f\u6e90\u4e1a\u4e3b\u63a5\u53d7\u5ba2\u6237\u8d37\u6b3e\u4e70\u623f\uff0c\u4f60\u53ef\u4ee5\u54a8\u8be2\u623f\u5c0f\u4e8c\u4e86\u89e3\u66f4\u591a\u623f\u6e90\u4fe1\u606f":"\u8be5\u623f\u6e90\u4e1a\u4e3b\u6682\u672a\u8bf4\u660e\u662f\u5426\u63a5\u53d7\u8d37\u6b3e\uff0c\u4f60\u53ef\u4ee5\u54a8\u8be2\u623f\u5c0f\u4e8c\u4e86\u89e3\u66f4\u591a\u623f\u6e90\u4fe1\u606f";break;case"fifth":s=1==t.is_key?"\u8be5\u623f\u6e90\u94a5\u5319\u5df2\u6258\u7ba1\uff0c\u53ef\u968f\u65f6\u8054\u7cfb\u623f\u5c0f\u4e8c\u770b\u623f":"\u4f60\u53ef\u4ee5\u8054\u7cfb\u623f\u5c0f\u4e8c\u5e2e\u52a9\u9884\u7ea6\u4e1a\u4e3b\u770b\u623f\u65f6\u95f4";break;case"sixth":s="\u4f60\u53ef\u4ee5\u8054\u7cfb\u623f\u5c0f\u4e8c\u4e86\u89e3\u4e1a\u4e3b\u63d0\u4f9b\u7684\u6700\u4f4e\u62a5\u4ef7"}var r=$(o);if("first"!=e&&n&&n.id){if(r.find(".not_user_agent_box").addClass("show"),r.find(".no_user_chat_tip").html(s),r.find(".not_user_agent_name").html(n.name),r.find(".not_user_agent_tel").html(n.telephone),r.find(".not_user_agent_img").attr("src","//"+dns.head+"/agent/avatar/summer/"+n.id+".jpg"),r.find(".not_user_agent_href").attr("href","/"+currentCity+"/agent/detail/"+n.id),n.center_id){var i=center_arr[n.center_id];r.find(".not_user_agent_center span").html(i.name)}if(n.qr_code){r.find(".agent_code_item_show").addClass("show");var c=r.find("#agent_wechat_code")[0];new QRCode(c,{text:n.qr_code,width:79,height:79,colorDark:"#424345",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.L})}r.find(".code_img_agent_face").attr("src","//"+dns.head+"/agent/avatar/summer/"+n.id+".jpg");var u=r.find("#agent_phone_code")[0];new QRCode(u,{text:"https://m.zhen22.com/"+currentCity+"/agent/detail/"+n.id+"/?call=true",width:79,height:79,colorDark:"#424345",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.L})}r.appendTo(a),setTimeout(function(){a.scrollTop=a.scrollHeight},300),"first"==e&&$(".no_user_chat_list").on("click","li",function(){var e=$(this),t=e.attr("data-index");G.chat.autoReplyMe(e.html()),setTimeout(function(){G.chat.checkAutoReply(t)},500)})},checkAutoReply:function(e){G.chat.autoReply(e)},autoReplyMe:function(e){var t=$("#auto-reply-me").html(),a=$(t);a.find(".chat_content .text").html(e),a.appendTo($(".chat_panel_content"))}},chatLogin:function(e){var t={house:e};$.utils.showLoginMain("chat",function(e,a){p(t,a)})},openChat:function(e){return Q.selToID==e.group_id&&!$("div.chat_panel_content").length<1?!1:(Q.selToID=e.group_id,G.chat.openChatPanel(e),void w(e))},fav_house:{data:{resell:[],newhouse:[],rent:[]},openHouse:function(e,t){switch(t){case"resell":window.open([$.utils.getCityUrl("/house/"),e,"/"].join(""));break;case"newhouse":window.open("/"+currentCity+"/new-house/detail/?id="+e+"/");break;case"rent":window.open("/"+currentCity+"/rent/detail/"+e+"/")}},getList:function(){$.ajax({type:"get",url:$.utils.getCityUrl("/fav/info"),dataType:"json",data:{t:(new Date).getTime()}}).success(function(e){if(0==e.code){G.fav_house.data.resell=[],G.fav_house.data.newhouse=[],G.fav_house.data.rent=[];for(var t=0;t<e.data.length;t++){var a=e.data[t];"resell"==a.type?G.fav_house.data.resell.push(a):"newhouse"==a.type?G.fav_house.data.newhouse.push(a):"rent"==a.type&&G.fav_house.data.rent.push(a)}}else $.utils.alert(e.msg)}).error(function(e){})},cancel_fav:function(e,t,a,o){t.stopPropagation();var s,r;switch(o){case"resell":s="/"+currentCity+"/fav/del",r={house_id:e};break;case"newhouse":s="/"+currentCity+"/fav/new_house_del",r={newhouse_id:e};break;case"rent":s="/"+currentCity+"/fav/rent_del",r={rent_id:e}}$.utils.alert({title:"\u5220\u9664\u6536\u85cf\u623f\u6e90",content:"\u786e\u8ba4\u5220\u9664 "+a+" \u5417?",onConfirm:function(e){e.stopPropagation(),n(s,r)}})}},contrast:{num:null,data:[],openHouse:function(e){window.open([$.utils.getCityUrl("/house/"),e,"/"].join(""))},getList:function(e){$.ajax({type:"post",url:$.utils.getCityUrl("/house/compare_json/"+e),dataType:"json"}).success(function(e){if(e.state){G.contrast.data=e.data;var a=e.not_house_id;if(a&&a.length>0)for(var n=t("contrast_"+currentCity),o=0;o<a.length;o++)r(a[o],n.split("-"))}else $.utils.alert(e.msg)}).error(function(e){})},cancel_fav:function(e,a){a.stopPropagation(),$.ajax({type:"get",url:"/"+currentCity+"/house/compare_statistics/?id="+e+"&viewType=compare_house_remove",dataType:"json",success:function(e){}});var n=t("contrast_"+currentCity);r(e,n.split("-"))},start_contrast:function(){var e=t("contrast_"+currentCity);return G.contrast.num<="1"?!1:void(location.href="/"+currentCity+"/house/compare/"+e)}},closeFloat:function(e){G.chat.chatMsgs=[]},agent:{setAgent:function(){user_id?location.href="/"+currentCity+"/exclusive":$.utils.showLoginMain("dl")}},sub:function(){P()},keydown:function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),P())},showEmtion:function(){$(".emotionList").empty(),I(["emotionBox"]);var e=webim.EmotionPicData;for(var t in e){var a=$("<a>").attr({id:t,src:e[t],title:t,"class":"emotionImg",style:"cursor:pointer;"}).click(function(){x(this)});$("<li>").append(a).appendTo($(".emotionList"))}},hideEmtion:function(){S(["emotionBox"])},showPhrase:function(){I(["phraseBox"])},hidePhrase:function(){S(["phraseBox"])},chosePhrase:function(e){var t=$(e.target).text(),a=document.getElementsByClassName("sendMsg")[0];a.focus(),"\u8bf7\u8f93\u5165\u60a8\u7684\u95ee\u9898."==$("#send_msg_text").val()&&$("#send_msg_text").val(""),a.value+=t,S(["phraseBox"]),P()},closeSider:function(e){G.opening=!1},openSider:function(e){if(e.login&&!user_id)return void $.utils.showLoginMain("dl");if(e.require){var t=e.require();if(!t.pass)return void $.utils.alert({content:t.msg,onConfirm:function(){t.redirect&&(location.href=t.redirect)}})}G.opening=G.opening===e.key?!1:e.key,"chat_log"==e.key&&G.opening&&b("chat_list")},stopPop:function(e){e.stopPropagation()},stopScroll:function(e){return e.stopPropagation(),e.preventDefault(),this.scrollTop+=e.wheelDelta>0?-30:30,!1},init:function(e){if("contrast"===e||!e){var a=t("contrast_"+currentCity);a&&(G.contrast.num=a.split("-").length,$.utilscontrastNum=a.split("-").length,o(a.split("-")),G.contrast.getList(a))}user_id&&("fav"!==e&&e||G.fav_house.getList())}}));$.utils.isIE([6,7,8,9])||avalon.effect("fadeTopAni",{enterClass:"fadeInDown",leaveClass:"fadeOutUp"}),G.$watch("buy_tool.taxe.data.*",l),G.$watch("buy_tool.loan.data.*",d),G.$watch("buy_tool.loan.rate.*",function(){u()}),d(),m(),avalon.scan(),avalon.ready(function(){G.inited=!0,G.init()}),$.utils||(jQuery.utils={}),$(window).load(function(){var e=sessionStorage.getItem(currentCity+"_chat");e&&user_id&&e==hid&&($.utils.chat.open({house:e}),sessionStorage.setItem(currentCity+"_chat",""))}),$.utils=$.extend($.utils,{chat:{open:function(e){return user_id?(Q.userFace={},void $.ajax({url:"/"+currentCity+"/chat/create_group",data:{house_id:e.house,from_account:z.identifier},type:"POST",dataType:"json",success:function(e){if(1!=e.code)return alert(e.msg),!1;Q.selToID=e.data.group_id,Q.curMsgCount=0;for(var t in e.data.face)Q.userFace[t]=e.data.face[t];G.chat.openChatPanel(e.data),w(e.data)},error:function(e){}})):($.utils.showLoginMain("chat",function(t,a){p(e,a)}),!1)},opens:function(e){$.ajax({url:"/"+currentCity+"/house/auto_create",data:{house_id:e.house},type:"POST",dataType:"json",success:function(e){if(1!=e.code)return alert(e.msg),!1;for(var t in e.data.face)Q.userFace[t]=e.data.face[t];G.chat.openChatPanel(e.data)},error:function(e){}})}},loan:function(e){G.buy_tool.loan.setData(e),G.opening="buy_tool"},agent:function(){G.opening="agent_chat"},join_contrast:function(e){$.ajax({type:"get",url:"/"+currentCity+"/house/compare_statistics/?id="+e+"&viewType=compare_house_add",dataType:"json",success:function(e){}});var n,o=t("contrast_"+currentCity);if(o){if(o.indexOf(e)>=0)return!1;if(o.split("-").length>=4)return $.utils.alert("\u5bf9\u6bd4\u6e05\u5355\u5df2\u6ee1\uff0c\u8bf7\u5220\u9664\u540e\u518d\u6dfb\u52a0"),!1;n=o+"-"+e}else n=e;"number"==typeof n?(G.contrast.num=1,$.utils.contrastNum=1):(G.contrast.num=n.split("-").length,$.utils.contrastNum=n.split("-").length),$(".contrast_"+e).addClass("contrasted").html("\u5df2\u52a0\u5165\u5bf9\u6bd4"),G.contrast.getList(n),a("contrast_"+currentCity,n)},contrastNum:G.contrast.num});var U=$(".contrasts");U.on("click",function(){var e=$(this),t=e.attr("data-house-id");$.utils.join_contrast(t)});var z,Q={appSdkId:imAppId,accountType:imAccountType,MaxMsgLen:{C2C:12e3,GROUP:8898},SessionType:{C2C:"C2C",GROUP:"GROUP"},selToID:null,selSess:null,curMsgCount:0,emotionFlag:!1,totalCount:1e3,maxNameLen:10,UploadPicBussinessType:{GROUP_MSG:1,C2C_MSG:2,USER_HEAD:3,GROUP_HEAD:4},identifier:null,userSing:null,login:!1,curPlayAudio:null,joinGroup:[],userFace:{},accountArr:[],limit:10,offset:1,total:null,groupIdList:{}},J=Q.SessionType.GROUP,Y="/a/desktop.desktop/a/public/default-face.jpg",X={onConnNotify:null,jsonpCallback:f,onMsgNotify:_,onGroupInfoChangeNotify:j,groupSystemNotifys:""};g(),"classList"in document.documentElement||Object.defineProperty(HTMLElement.prototype,"classList",{get:function(){function e(e){return function(a){var n=t.className.split(/\s+/g),o=n.indexOf(a);e(n,o,a),t.className=n.join(" ")}}var t=this;return{add:e(function(e,t,a){~t||e.push(a)}),remove:e(function(e,t){~t&&e.splice(t,1)}),toggle:e(function(e,t,a){~t?e.splice(t,1):e.push(a)}),contains:function(e){return!!~t.className.split(/\s+/g).indexOf(e)},item:function(e){
            return t.className.split(/\s+/g)[e]||null}}}}),$(".listPage ul").on("click",function(e){var t=e.target;if($(t).attr("data-num")&&!$(t).parent().hasClass("active")){var a=$(t).attr("data-num")-1,n=a*Q.limit;Q.offset=n,D(null,n),b("logIm",Q.limit,Q.offset+1)}}),$(document).ready(function(){$(".panel_content").mCustomScrollbar({scrollButtons:{enable:!0,scrollType:"continuous",scrollSpeed:"",scrollAmount:40}})});var K=$(".promotion");K.on("click",function(e){-1!==e.target.className.split(" ").indexOf("promotion-close")&&R()})}),$(function(){var e=function(e,t,a){var n={speed:166.67,curvature:.001,progress:function(){},complete:function(){}},o={};a=a||{};for(var s in n)o[s]=a[s]||n[s];var r={mark:function(){return this},position:function(){return this},move:function(){return this},init:function(){return this}},i="margin",c=document.createElement("div");"oninput"in c&&["","ms","webkit"].forEach(function(e){var t=e+(e?"T":"t")+"ransform";t in c.style&&(i=t)});var u=o.curvature,l=0,d=!0;if(e&&t&&1==e.nodeType&&1==t.nodeType){var m={},p={},f={},g={},h={},_={};r.mark=function(){return 0==d?this:("undefined"==typeof h.x&&this.position(),e.setAttribute("data-center",[h.x,h.y].join()),t.setAttribute("data-center",[_.x,_.y].join()),this)},r.position=function(){if(0==d)return this;var a=document.documentElement.scrollLeft||document.body.scrollLeft,n=document.documentElement.scrollTop||document.body.scrollTop;return"margin"==i?e.style.marginLeft=e.style.marginTop="0px":e.style[i]="translate(0, 0)",m=e.getBoundingClientRect(),p=t.getBoundingClientRect(),f={x:m.left+(m.right-m.left)/2+a,y:m.top+(m.bottom-m.top)/2+n},g={x:p.left+(p.right-p.left)/2+a,y:p.top+(p.bottom-p.top)/3.5+n},h={x:0,y:0},_={x:-1*(f.x-g.x),y:-1*(f.y-g.y)},l=(_.y-u*_.x*_.x)/_.x,this},r.move=function(){if(0==d)return this;var t=0,a=_.x>0?1:-1,n=function(){var s=2*u*t+l;t+=a*Math.sqrt(o.speed/(s*s+1)),(1==a&&t>_.x||-1==a&&t<_.x)&&(t=_.x);var r=t,c=u*r*r+l*r;e.setAttribute("data-center",[Math.round(r),Math.round(c)].join()),"margin"==i?(e.style.marginLeft=r+"px",e.style.marginTop=c+"px"):e.style[i]="translate("+[r+"px",c+"px"].join()+")",t!==_.x?(o.progress(r,c),window.requestAnimationFrame(n)):(o.complete(),d=!0)};return window.requestAnimationFrame(n),d=!1,this},r.init=function(){this.position().mark().move()}}return r},t=document.getElementById("fly"),a=document.getElementById("contrast"),n=0,o=e(t,a,{speed:400,curvature:.002,complete:function(){t.style.visibility="hidden",++n}});t&&a&&[].slice.call(document.getElementsByClassName("contrasts")).forEach(function(e){e.addEventListener("click",function(){var e=$(this);if(e.hasClass("contrasted"))return!1;if(4==$.utils.contrastNum)return!1;var a=document.documentElement.scrollLeft||document.body.scrollLeft||0,n=document.documentElement.scrollTop||document.body.scrollTop||0;t.style.left=event.clientX+a+"px",t.style.top=event.clientY+n+"px",t.style.visibility="visible",o.position().move()})});var a=$(".contrasts");a.on("click",function(){var e=$(this),t=e.attr("data-house-id");$.utils.join_contrast(t)})});