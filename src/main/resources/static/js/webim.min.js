var webim={init:function(e,t,n){},syncMsgs:function(e,t){},syncGroupMsgs:function(e,t,n){},sendMsg:function(e,t,n){},offline:function(e,t){},setAutoRead:function(e,t,n){},getProfilePortrait:function(e,t,n){},setProfilePortrait:function(e,t,n){},applyAddFriend:function(e,t,n){},getPendency:function(e,t,n){},deletePendency:function(e,t,n){},responseFriend:function(e,t,n){},getAllFriend:function(e,t,n){},deleteFriend:function(e,t,n){},addBlackList:function(e,t,n){},getBlackList:function(e,t,n){},deleteBlackList:function(e,t,n){},uploadPic:function(e,t,n){},createGroup:function(e,t,n){},applyJoinGroup:function(e,t,n){},handleApplyJoinGroup:function(e,t,n){},deleteApplyJoinGroupPendency:function(e,t,n){},quitGroup:function(e,t,n){},getGroupPublicInfo:function(e,t,n){},getGroupInfo:function(e,t,n){},modifyGroupBaseInfo:function(e,t,n){},destroyGroup:function(e,t,n){},getJoinedGroupListHigh:function(e,t,n){},getGroupMemberInfo:function(e,t,n){},addGroupMember:function(e,t,n){},modifyGroupMember:function(e,t,n){},forbidSendMsg:function(e,t,n){},deleteGroupMember:function(e,t,n){},sendCustomGroupNotify:function(e,t,n){},Msg:function(e,t,n,o,i,r){},MsgStore:{sessMap:function(){return{}},sessCount:function(){return 0},sessByTypeId:function(e,t){return{}},delSessByTypeId:function(e,t){return!0},resetCookieAndSyncFlag:function(){}}};!function(e){var t="https://webim.tim.qq.com",n={},o="openim",i="group_open_http_svc",r="sns",a="profile",s="openpic",u={openim:"v4",group_open_http_svc:"v3",sns:"v3",profile:"v3",openpic:"v1"},c="v1.3",l="C2C",p="GROUP",f="OK",m="FAIL",d=99999,g="TIMTextElem",I="TIMFaceElem",h="TIMImageElem",_="TIMSoundElem",y="TIMFileElem",M="TIMLocationElem",b="TIMCustomElem",A="TIMGroupTipElem",T={ORIGIN:1,LARGE:2,SMALL:3},E="10001",v={SOUND:2106,FILE:2107},S={C2C:1,GROUP_ORDINARY:3,GROUP_TIP:4,GROUP_SYSTEM:5},C={JOIN:1,QUIT:2,KICK:3,SET_ADMIN:4,CANCEL_ADMIN:5,MODIFY_GROUP_INFO:6,MODIFY_MEMBER_INFO:7},G={FACE_URL:1,NAME:2,OWNER:3,NOTIFICATION:4,INTRODUCTION:5},F={JOIN_GROUP_REQUEST:1,JOIN_GROUP_ACCEPT:2,JOIN_GROUP_REFUSE:3,KICK:4,DESTORY:5,CREATE:6,INVITED_JOIN_GROUP_REQUEST:7,QUIT:8,SET_ADMIN:9,CANCEL_ADMIN:10,REVOKE:11,CUSTOM:255},k=10,R=0,U=15,L=0,w=null,N=null,O={sdkAppID:null,appIDAt3rd:null,accountType:null,identifier:null,userSig:null,contentType:"json",apn:1},D={},x={},P=[],q={"[\u5fae\u7b11]":1,"[\u6487\u5634]":2,"[\u8272]":3,"[\u53d1\u5446]":4,"[\u5f97\u610f]":5,"[\u6d41\u6cea]":6,"[\u5bb3\u7f9e]":7,"[\u95ed\u5634]":8,"[\u7761]":9,"[\u5927\u54ed]":10,"[\u5c34\u5c2c]":11,"[\u53d1\u6012]":12,"[\u8c03\u76ae]":13,"[\u5472\u7259]":14,"[\u60ca\u8bb6]":15,"[\u96be\u8fc7]":16,"[\u9177]":17,"[\u51b7\u6c57]":18,"[\u6293\u72c2]":19,"[\u5410]":20,"[\u5077\u7b11]":21,"[\u53ef\u7231]":22,"[\u767d\u773c]":23,"[\u50b2\u6162]":24,"[\u9965\u997f]":25,"[\u56f0]":26,"[\u60ca\u6050]":27,"[\u6d41\u6c57]":28,"[\u61a8\u7b11]":29,"[\u5927\u5175]":30,"[\u594b\u6597]":31,"[\u5492\u9a82]":32,"[\u7591\u95ee]":33,"[\u5618]":34,"[\u6655]":35,"[\u6298\u78e8]":36,"[\u8870]":37,"[\u9ab7\u9ac5]":38,"[\u6572\u6253]":39,"[\u518d\u89c1]":40,"[\u64e6\u6c57]":41,"[\u62a0\u9f3b]":42,"[\u9f13\u638c]":43,"[\u7cd7\u5927\u4e86]":44,"[\u574f\u7b11]":45,"[\u5de6\u54fc\u54fc]":46,"[\u53f3\u54fc\u54fc]":47,"[\u54c8\u6b20]":48,"[\u9119\u89c6]":49,"[\u59d4\u5c48]":50,"[\u5feb\u54ed\u4e86]":51,"[\u9634\u9669]":52,"[\u4eb2\u4eb2]":53,"[\u5413]":54,"[\u53ef\u601c]":55,"[\u83dc\u5200]":56,"[\u897f\u74dc]":57,"[\u5564\u9152]":58,"[\u7bee\u7403]":59,"[\u4e52\u4e53]":60,"[\u5496\u5561]":61,"[\u996d]":62,"[\u732a\u5934]":63,"[\u73ab\u7470]":64,"[\u51cb\u8c22]":65,"[\u793a\u7231]":66,"[\u7231\u5fc3]":67},B={"[\u5fae\u7b11]":"/a/mobile/a/face/face_00.png","[\u6487\u5634]":"/a/mobile/a/face/face_01.png","[\u8272]":"/a/mobile/a/face/face_02.png","[\u53d1\u5446]":"/a/mobile/a/face/face_03.png","[\u5f97\u610f]":"/a/mobile/a/face/face_04.png","[\u6d41\u6cea]":"/a/mobile/a/face/face_05.png","[\u5bb3\u7f9e]":"/a/mobile/a/face/face_06.png","[\u95ed\u5634]":"/a/mobile/a/face/face_07.png","[\u7761]":"/a/mobile/a/face/face_08.png","[\u5927\u54ed]":"/a/mobile/a/face/face_09.png","[\u5c34\u5c2c]":"/a/mobile/a/face/face_10.png","[\u53d1\u6012]":"/a/mobile/a/face/face_11.png","[\u8c03\u76ae]":"/a/mobile/a/face/face_12.png","[\u5472\u7259]":"/a/mobile/a/face/face_13.png","[\u60ca\u8bb6]":"/a/mobile/a/face/face_14.png","[\u96be\u8fc7]":"/a/mobile/a/face/face_15.png","[\u9177]":"/a/mobile/a/face/face_16.png","[\u51b7\u6c57]":"/a/mobile/a/face/face_17.png","[\u6293\u72c2]":"/a/mobile/a/face/face_18.png","[\u5410]":"/a/mobile/a/face/face_19.png","[\u5077\u7b11]":"/a/mobile/a/face/face_20.png","[\u53ef\u7231]":"/a/mobile/a/face/face_21.png","[\u767d\u773c]":"/a/mobile/a/face/face_22.png","[\u50b2\u6162]":"/a/mobile/a/face/face_23.png","[\u9965\u997f]":"/a/mobile/a/face/face_24.png","[\u56f0]":"/a/mobile/a/face/face_25.png","[\u60ca\u6050]":"/a/mobile/a/face/face_26.png","[\u6d41\u6c57]":"/a/mobile/a/face/face_27.png","[\u61a8\u7b11]":"/a/mobile/a/face/face_28.png","[\u5927\u5175]":"/a/mobile/a/face/face_29.png","[\u594b\u6597]":"/a/mobile/a/face/face_30.png","[\u5492\u9a82]":"/a/mobile/a/face/face_31.png","[\u7591\u95ee]":"/a/mobile/a/face/face_32.png","[\u5618]":"/a/mobile/a/face/face_33.png","[\u6655]":"/a/mobile/a/face/face_34.png","[\u6298\u78e8]":"/a/mobile/a/face/face_35.png","[\u8870]":"/a/mobile/a/face/face_36.png","[\u9ab7\u9ac5]":"/a/mobile/a/face/face_37.png","[\u6572\u6253]":"/a/mobile/a/face/face_38.png","[\u518d\u89c1]":"/a/mobile/a/face/face_39.png","[\u64e6\u6c57]":"/a/mobile/a/face/face_40.png","[\u62a0\u9f3b]":"/a/mobile/a/face/face_41.png","[\u9f13\u638c]":"/a/mobile/a/face/face_42.png","[\u7cd7\u5927\u4e86]":"/a/mobile/a/face/face_43.png","[\u574f\u7b11]":"/a/mobile/a/face/face_44.png","[\u5de6\u54fc\u54fc]":"/a/mobile/a/face/face_45.png","[\u53f3\u54fc\u54fc]":"/a/mobile/a/face/face_46.png","[\u54c8\u6b20]":"/a/mobile/a/face/face_47.png","[\u9119\u89c6]":"/a/mobile/a/face/face_48.png","[\u59d4\u5c48]":"/a/mobile/a/face/face_49.png","[\u5feb\u54ed\u4e86]":"/a/mobile/a/face/face_50.png","[\u9634\u9669]":"/a/mobile/a/face/face_51.png","[\u4eb2\u4eb2]":"/a/mobile/a/face/face_52.png","[\u5413]":"/a/mobile/a/face/face_53.png","[\u53ef\u601c]":"/a/mobile/a/face/face_54.png","[\u83dc\u5200]":"/a/mobile/a/face/face_55.png","[\u897f\u74dc]":"/a/mobile/a/face/face_56.png","[\u5564\u9152]":"/a/mobile/a/face/face_57.png","[\u7bee\u7403]":"/a/mobile/a/face/face_58.png","[\u4e52\u4e53]":"/a/mobile/a/face/face_59.png","[\u5496\u5561]":"/a/mobile/a/face/face_60.png","[\u996d]":"/a/mobile/a/face/face_61.png","[\u732a\u5934]":"/a/mobile/a/face/face_62.png","[\u73ab\u7470]":"/a/mobile/a/face/face_63.png","[\u51cb\u8c22]":"/a/mobile/a/face/face_64.png","[\u793a\u7231]":"/a/mobile/a/face/face_65.png","[\u7231\u5fc3]":"/a/mobile/a/face/face_66.png"},z=new function(){this.formatTimeStamp=function(e,t){if(0==e)return e;t=t||"yyyy-MM-dd hh:mm:ss";var n,o=new Date(1e3*e),i={"M+":o.getMonth()+1,"d+":o.getDate(),"h+":o.getHours(),"m+":o.getMinutes(),"s+":o.getSeconds()};/(y+)/.test(t)&&(n=t.replace(RegExp.$1,(o.getFullYear()+"").substr(4-RegExp.$1.length)));for(var r in i)new RegExp("("+r+")").test(n)&&(n=n.replace(RegExp.$1,1==RegExp.$1.length?i[r]:("00"+i[r]).substr((""+i[r]).length)));return n},this.groupTypeEn2Ch=function(e){var t=null;switch(e){case"Public":t="\u516c\u5f00\u7fa4";break;case"ChatRoom":t="\u804a\u5929\u5ba4";break;case"Private":t="\u8ba8\u8bba\u7ec4";break;default:t=e}return t},this.groupTypeCh2En=function(e){var t=null;switch(e){case"\u516c\u5f00\u7fa4":t="Public";break;case"\u804a\u5929\u5ba4":t="ChatRoom";break;case"\u8ba8\u8bba\u7ec4":t="Private";break;default:t=e}return t},this.groupRoleEn2Ch=function(e){var t=null;switch(e){case"Member":t="\u6210\u5458";break;case"Admin":t="\u7ba1\u7406\u5458";break;case"Owner":t="\u7fa4\u4e3b";break;default:t=e}return t},this.groupRoleCh2En=function(e){var t=null;switch(e){case"\u6210\u5458":t="Member";break;case"\u7ba1\u7406\u5458":t="Admin";break;case"\u7fa4\u4e3b":t="Owner";break;default:t=e}return t},this.groupMsgFlagEn2Ch=function(e){var t=null;switch(e){case"AcceptAndNotify":t="\u63a5\u6536\u5e76\u63d0\u793a";break;case"AcceptNotNotify":t="\u63a5\u6536\u4e0d\u63d0\u793a";break;case"Discard":t="\u5c4f\u853d";break;default:t=e}return t},this.groupMsgFlagCh2En=function(e){var t=null;switch(e){case"\u63a5\u6536\u5e76\u63d0\u793a":t="AcceptAndNotify";break;case"\u63a5\u6536\u4e0d\u63d0\u793a":t="AcceptNotNotify";break;case"\u5c4f\u853d":t="Discard";break;default:t=e}return t},this.formatText2Html=function(e){var t=e;return t&&(t=this.xssFilter(t),t=t.replace(/ /g,"&nbsp;"),t=t.replace(/\n/g,"<br/>")),t},this.formatHtml2Text=function(e){var t=e;return t&&(t=t.replace(/&nbsp;/g," "),t=t.replace(/<br\/>/g,"\n")),t},this.getStrBytes=function(e){return null==e?0:("string"!=typeof e&&(e+=""),e.replace(/[^x00-xff]/g,"012").length)},this.xssFilter=function(e){return e=e.toString(),e=e.replace(/[<]/g,"&lt;"),e=e.replace(/[>]/g,"&gt;"),e=e.replace(/"/g,"&quot;")},this.trimStr=function(e){return e?(e=e.toString(),e.replace(/(^\s*)|(\s*$)/g,"")):""},this.validNumber=function(e){return e=e.toString(),e.match(/(^\d{1,8}$)/g)},this.getReturnError=function(e){var t={ActionStatus:m,ErrorInfo:e};return t},this.setCookie=function(e,t,n,o,i){var r=new Date;r.setTime(r.getTime()+1e3*n),document.cookie=e+"="+escape(t)+";expires="+r.toGMTString()},this.getCookie=function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?unescape(t[2]):null},this.delCookie=function(e){var t=new Date;t.setTime(t.getTime()-1);var n=this.getCookie(e);null!=n&&(document.cookie=e+"="+escape(n)+";expires="+t.toGMTString())},this.isIE=function(e){var t=document.createElement("b");return t.innerHTML="<!--[if IE "+e+"]><i></i><![endif]-->",1===t.getElementsByTagName("i").length},this.getBrowserInfo=function(){var e,t={},n=navigator.userAgent.toLowerCase();return(e=n.match(/msie ([\d.]+)/))?t.ie=e[1]:(e=n.match(/firefox\/([\d.]+)/))?t.firefox=e[1]:(e=n.match(/chrome\/([\d.]+)/))?t.chrome=e[1]:(e=n.match(/opera.([\d.]+)/))?t.opera=e[1]:(e=n.match(/version\/([\d.]+).*safari/))?t.safari=e[1]:0,t.ie?{type:"ie",ver:t.ie}:t.firefox?{type:"firefox",ver:t.firefox}:t.chrome?{type:"chrome",ver:t.chrome}:t.opera?{type:"opera",ver:t.opera}:t.safari?{type:"safari",ver:t.safari}:{type:"unknow",ver:-1}}},H=function(e){return e||(e=new Date),Math.round(e.getTime()/1e3)},J=function(e){var t=x[e];return t=t?x[e]=t+1:x[e]=1},K=function(){return Math.round(4294967296*Math.random())},Y=function(){var e=null;if(window.XMLHttpRequest)e=new XMLHttpRequest;else try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){return null}}return e},j=function(e,t,o,i,r){var a,s,u=Y();if(!u){s="\u521b\u5efa\u8bf7\u6c42\u5931\u8d25";var a=z.getReturnError(s);return void(r&&r(a))}u.open(e,t,!0),u.onreadystatechange=function(){if(4==u.readyState)if(200==u.status)i&&i(u.responseText),u=null;else{var e="["+u.status+"]\u8bf7\u6c42\u670d\u52a1\u5668\u5931\u8d25",t=z.getReturnError(e);u=null,r&&r(t)}},"safari"==n.type&&u.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),u.send(o)},Q=function(e,t,n,o,i){j(e,t,JSON.stringify(n),function(e){var t=null;e&&(t=JSON.parse(e)),o&&o(t)},i)},V=function(){return O.sdkAppID&&O.identifier},W=function(){return V()?!0:!1},$=function(e,n){var c=t+"/"+u[e]+"/"+e+"/"+n+"?";switch(e){case o:c+="usersig="+O.userSig;break;case i:c+="accesstoken="+O.userSig;break;case r:c+="accesstoken="+O.userSig;break;case a:c+="accesstoken="+O.userSig;break;case s:c+="usersig="+O.userSig;break;default:c+="accesstoken="+O.userSig}return c+="&sdkappid="+O.sdkAppID+"&identifier="+encodeURIComponent(O.identifier)+"&appidat3rd="+O.appIDAt3rd+"&accounttype="+O.accountType+"&apn="+O.apn+"&contenttype="+O.contentType,c+="&reqtime="+H()},X=function(e,t){W()&&xe.apiCall(o,"logout",{},e,t)},Z=function(e,t,n){if(W()){var r=null;switch(e.sess.type()){case l:r={From_Account:O.identifier,To_Account:e.sess.id(),MsgTimeStamp:e.time,MsgSeq:e.seq,MsgRandom:e.random,MsgBody:[]};break;case p:r={GroupId:e.sess.id(),MsgBody:[]}}for(var a in e.elems){var s=e.elems[a],u=null,c=s.type;switch(c){case g:u={Text:s.content.text};break;case I:u={Index:s.content.index,Data:s.content.data};break;case h:var f=[];for(var m in s.content.ImageInfoArray)f.push({Type:s.content.ImageInfoArray[m].type,Size:s.content.ImageInfoArray[m].size,Width:s.content.ImageInfoArray[m].width,Height:s.content.ImageInfoArray[m].height,URL:s.content.ImageInfoArray[m].url});u={UUID:s.content.UUID,ImageInfoArray:f};break;case _:u={Text:"web\u7aef\u6682\u4e0d\u652f\u6301\u53d1\u9001\u8bed\u97f3\u6d88\u606f"},c=g;break;case M:u={Text:"web\u7aef\u6682\u4e0d\u652f\u6301\u53d1\u9001\u5730\u7406\u4f4d\u7f6e\u6d88\u606f"},c=g;break;case y:u={Text:"web\u7aef\u6682\u4e0d\u652f\u6301\u53d1\u9001\u6587\u4ef6\u6d88\u606f"},c=g;break;case b:u={Data:s.content.data,Desc:s.content.desc,Ext:s.content.ext},c=b;break;default:u={Text:"web\u7aef\u6682\u4e0d\u652f\u6301\u53d1\u9001"+s.type+"\u6d88\u606f"},c=g}r.MsgBody.push({MsgType:c,MsgContent:u})}e.sess.type()==l?xe.apiCall(o,"sendmsg",r,t,n):e.sess.type()==p&&xe.apiCall(i,"send_group_msg",r,t,n)}},ee=function(e,t,n){W()&&Ke&&xe.apiCall(o,"longpolling",e,t,n)},te=function(e,t,n,i){W()&&xe.apiCall(o,"getmsg",{Cookie:e,SyncFlag:t},function(e){if(e.MsgList&&e.MsgList.length)for(var t in e.MsgList)P.push(e.MsgList[t]);1==e.SyncFlag?te(e.Cookie,e.SyncFlag,n,i):(e.MsgList=P,P=[],n&&n(e))},i)},ne=function(e,t,n,i){if(W()){var r=[];for(var a in t){var s={To_Account:t[a].toAccount,LastedMsgTime:t[a].lastedMsgTime};r.push(s)}xe.apiCall(o,"msgreaded",{C2CMsgReaded:{Cookie:e,C2CMsgReadedItem:r}},n,i)}},oe=function(e,t,n){W()&&xe.apiCall(o,"deletemsg",e,t,n)},ie=function(e,t,n){if(W()){for(var o={Owner_Account:e.Owner_Account,Type:e.Type,Name:e.Name,Introduction:e.Introduction,Notification:e.Notification},r=[],a=0;a<e.MemberList.length;a++)r.push({Member_Account:e.MemberList[a]});o.MemberList=r,e.MaxMemberCount&&(o.MaxMemberCount=e.MaxMemberCount),e.ApplyJoinOption&&(o.ApplyJoinOption=e.ApplyJoinOption),e.AppDefinedData&&(o.AppDefinedData=e.AppDefinedData),e.FaceUrl&&(o.FaceUrl=e.FaceUrl),xe.apiCall(i,"create_group",o,t,n)}},re=function(e,t,n){W()&&xe.apiCall(i,"modify_group_base_info",e,t,n)},ae=function(e,t,n){W()&&xe.apiCall(i,"apply_join_group",{GroupId:e.GroupId,ApplyMsg:e.ApplyMsg,UserDefinedField:e.UserDefinedField},t,n)},se=function(e,t,n){W()&&xe.apiCall(i,"handle_apply_join_group",{GroupId:e.GroupId,Applicant_Account:e.Applicant_Account,HandleMsg:e.HandleMsg,Authentication:e.Authentication,MsgKey:e.MsgKey,ApprovalMsg:e.ApprovalMsg,UserDefinedField:e.UserDefinedField},t,n)},ue=function(e,t,n){W()&&xe.apiCall(i,"quit_group",{GroupId:e.GroupId},t,n)},ce=function(e,t,n){W()&&xe.apiCall(i,"get_group_public_info",{GroupIdList:e.GroupIdList,ResponseFilter:{GroupBasePublicInfoFilter:e.GroupBasePublicInfoFilter}},function(e){if(e.ErrorInfo="",e.GroupInfo)for(var o in e.GroupInfo){var i=e.GroupInfo[o].ErrorCode;i>0&&(e.ActionStatus=m,e.GroupInfo[o].ErrorInfo="["+i+"]"+e.GroupInfo[o].ErrorInfo,e.ErrorInfo+=e.GroupInfo[o].ErrorInfo+"\n")}e.ActionStatus==m?n&&n(e):t&&t(e)},n)},le=function(e,t,n){if(W()){var o={GroupIdList:e.GroupIdList,ResponseFilter:{GroupBaseInfoFilter:e.GroupBaseInfoFilter,MemberInfoFilter:e.MemberInfoFilter,AppDefinedDataFilter_Group:e.AppDefinedDataFilter_Group}};xe.apiCall(i,"get_group_info",o,t,n)}},pe=function(e,t,n){W()&&xe.apiCall(i,"get_group_member_info",{GroupId:e.GroupId,Offset:e.Offset,Limit:e.Limit,MemberInfoFilter:e.MemberInfoFilter},t,n)},fe=function(e,t,n){W()&&xe.apiCall(i,"add_group_member",{GroupId:e.GroupId,Silence:e.Silence,MemberList:e.MemberList},t,n)},me=function(e,t,n){if(W()){var o={};e.GroupId&&(o.GroupId=e.GroupId),e.Member_Account&&(o.Member_Account=e.Member_Account),e.Role&&(o.Role=e.Role),e.MsgFlag&&(o.MsgFlag=e.MsgFlag),e.ShutUpTime&&(o.ShutUpTime=e.ShutUpTime),xe.apiCall(i,"modify_group_member_info",o,t,n)}},de=function(e,t,n){W()&&xe.apiCall(i,"delete_group_member",{GroupId:e.GroupId,Silence:e.Silence,MemberToDel_Account:e.MemberToDel_Account},t,n)},ge=function(e,t,n){W()&&xe.apiCall(i,"destroy_group",{GroupId:e.GroupId},t,n)},Ie=function(e,t,n){W()&&xe.apiCall(i,"get_joined_group_list",{Member_Account:e.Member_Account,Limit:e.Limit,Offset:e.Offset,GroupType:e.GroupType,ResponseFilter:{GroupBaseInfoFilter:e.GroupBaseInfoFilter,SelfInfoFilter:e.SelfInfoFilter}},t,n)},he=function(e,t,n){W()&&xe.apiCall(i,"get_role_in_group",{GroupId:e.GroupId,User_Account:e.User_Account},t,n)},_e=function(e,t,n){W()&&xe.apiCall(i,"forbid_send_msg",{GroupId:e.GroupId,Members_Account:e.Members_Account,ShutUpTime:e.ShutUpTime},t,n)},ye=function(e,t,n){W()&&xe.apiCall(i,"send_group_system_notification",e,t,n)},Me=function(e,t,n){W()&&xe.apiCall(i,"group_msg_get",{GroupId:e.GroupId,ReqMsgSeq:e.ReqMsgSeq,ReqMsgNumber:e.ReqMsgNumber},t,n)},be=function(e,t,n){W()&&xe.apiCall(i,"msg_read_report",{GroupId:e.GroupId,MsgReadedSeq:e.MsgReadedSeq},t,n)},Ae=function(e){var t=[];if(e.Fail_Account&&e.Fail_Account.length&&(t=e.Fail_Account),e.Invalid_Account&&e.Invalid_Account.length)for(var n in e.Invalid_Account)t.push(e.Invalid_Account[n]);if(t.length){e.ActionStatus=m,e.ErrorCode=d,e.ErrorInfo="";for(var o in t){var i=t[o];for(var r in e.ResultItem)if(e.ResultItem[r].To_Account==i){var a=e.ResultItem[r].ResultCode;e.ResultItem[r].ResultInfo="["+a+"]"+e.ResultItem[r].ResultInfo,e.ErrorInfo+=e.ResultItem[r].ResultInfo+"\n";break}}}return e},Te=function(e,t,n){W()&&xe.apiCall(r,"friend_add",{From_Account:e.From_Account,AddFriendItem:e.AddFriendItem},function(e){var o=Ae(e);o.ActionStatus==m?n&&n(o):t&&t(o)},n)},Ee=function(e,t,n){W()&&xe.apiCall(r,"friend_delete",{From_Account:e.From_Account,To_Account:e.To_Account,DeleteType:e.DeleteType},function(e){var o=Ae(e);o.ActionStatus==m?n&&n(o):t&&t(o)},n)},ve=function(e,t,n){W()&&xe.apiCall(r,"pendency_get",{From_Account:e.From_Account,PendencyType:e.PendencyType,StartTime:e.StartTime,MaxLimited:e.MaxLimited,LastSequence:e.LastSequence},t,n)},Se=function(e,t,n){W()&&xe.apiCall(r,"pendency_delete",{From_Account:e.From_Account,PendencyType:e.PendencyType,To_Account:e.To_Account},function(e){var o=Ae(e);o.ActionStatus==m?n&&n(o):t&&t(o)},n)},Ce=function(e,t,n){W()&&xe.apiCall(r,"friend_response",{From_Account:e.From_Account,ResponseFriendItem:e.ResponseFriendItem},function(e){var o=Ae(e);o.ActionStatus==m?n&&n(o):t&&t(o)},n)},Ge=function(e,t,n){W()&&xe.apiCall(r,"friend_get_all",{From_Account:e.From_Account,TimeStamp:e.TimeStamp,StartIndex:e.StartIndex,GetCount:e.GetCount,LastStandardSequence:e.LastStandardSequence,TagList:e.TagList},t,n)},Fe=function(e,t,n){W()&&xe.apiCall(a,"portrait_get",{From_Account:e.From_Account,To_Account:e.To_Account,LastStandardSequence:e.LastStandardSequence,TagList:e.TagList},function(e){var o=[];if(e.Fail_Account&&e.Fail_Account.length&&(o=e.Fail_Account),e.Invalid_Account&&e.Invalid_Account.length)for(var i in e.Invalid_Account)o.push(e.Invalid_Account[i]);if(o.length){e.ActionStatus=m,e.ErrorCode=d,e.ErrorInfo="";for(var r in o){var a=o[r];for(var s in e.UserProfileItem)if(e.UserProfileItem[s].To_Account==a){var u=e.UserProfileItem[s].ResultCode;e.UserProfileItem[s].ResultInfo="["+u+"]"+e.UserProfileItem[s].ResultInfo,e.ErrorInfo+="\u8d26\u53f7:"+a+","+e.UserProfileItem[s].ResultInfo+"\n";break}}}e.ActionStatus==m?n&&n(e):t&&t(e)},n)},ke=function(e,t,n){W()&&xe.apiCall(a,"portrait_set",{From_Account:e.From_Account,ProfileItem:e.ProfileItem},t,n)},Re=function(e,t,n){W()&&xe.apiCall(r,"black_list_add",{From_Account:e.From_Account,To_Account:e.To_Account},function(e){var o=Ae(e);o.ActionStatus==m?n&&n(o):t&&t(o)},n)},Ue=function(e,t,n){W()&&xe.apiCall(r,"black_list_delete",{From_Account:e.From_Account,To_Account:e.To_Account},function(e){var o=Ae(e);o.ActionStatus==m?n&&n(o):t&&t(o)},n)},Le=function(e,t,n){W()&&xe.apiCall(r,"black_list_get",{From_Account:e.From_Account,StartIndex:e.StartIndex,MaxLimited:e.MaxLimited,LastSequence:e.LastSequence},t,n)},we=function(e,t,n){W()&&xe.apiCall(s,"pic_up",{App_Version:c,From_Account:e.From_Account,To_Account:e.To_Account,Seq:e.Seq,Timestamp:e.Timestamp,Random:e.Random,File_Str_Md5:e.File_Str_Md5,File_Size:e.File_Size,Busi_Id:e.Busi_Id,PkgFlag:e.PkgFlag,Slice_Offset:e.Slice_Offset,Slice_Size:e.Slice_Size,Slice_Data:e.Slice_Data},t,n)},Ne=function(e,t){W()&&xe.apiCall(o,"authkey",{},e,t)},Oe=!1,De=z.getBrowserInfo();"ie"==De.type&&parseInt(De.ver)<10&&(Oe=!0);var xe=0==Oe?new function(){var e=null;this.init=function(t){e=t},this.apiCall=function(e,t,n,o,i){var r=$(e,t);Q("POST",r,n,function(e){e.ActionStatus==f?o&&o(e):i&&(e.ErrorInfo="["+e.ErrorCode+"]"+e.ErrorInfo,i(e))},i)}}:new function(){var e=null;this.init=function(t){e=t},this.apiCall=function(e,t,n,o,i){var r=$(e,t),a=L++,s="jsonpcallback",u="jsonpRequest"+a,c=document.createElement("script"),l=0;window[u]=N,c.type="text/javascript",r=r+"&"+s+"="+u+"&jsonpbody="+encodeURIComponent(JSON.stringify(n)),c.src=r,c.async=!0,"undefined"!=typeof c.onreadystatechange&&(c.event="onclick",c.htmlFor=c.id="_jsonpRequest_"+a),c.onload=c.onreadystatechange=function(){if(this.readyState&&"complete"!==this.readyState&&"loaded"!==this.readyState||l)return!1;c.onload=c.onreadystatechange=null,c.onclick&&c.onclick();var e=w;e.ActionStatus==f?o&&o(e):(e.ErrorInfo="["+e.ErrorCode+"]"+e.ErrorInfo,i&&i(e)),w=void 0,document.body.removeChild(c),l=1},document.body.appendChild(c)}},Pe=function(e,t,n,o,i,r){this._impl={skey:Pe.skey(e,t),type:e,id:t,name:n,icon:o,unread:0,isAutoRead:!1,time:i>=0?i:0,curMaxMsgSeq:r>=0?r:0,msgs:[]}};Pe.skey=function(e,t){return e+t},Pe.prototype.type=function(){return this._impl.type},Pe.prototype.id=function(){return this._impl.id},Pe.prototype.name=function(){return this._impl.name},Pe.prototype.icon=function(){return this._impl.icon},Pe.prototype.unread=function(){return this._impl.unread},Pe.prototype.time=function(){return this._impl.time},Pe.prototype.curMaxMsgSeq=function(){return this._impl.curMaxMsgSeq},Pe.prototype.msgCount=function(){return this._impl.msgs.length},Pe.prototype.msg=function(e){return this._impl.msgs[e]},Pe.prototype._impl_addMsg=function(e){this._impl.msgs.push(e),e.time>this._impl.time&&(this._impl.time=e.time),e.seq>this._impl.curMaxMsgSeq&&(this._impl.curMaxMsgSeq=e.seq),e.isSend||this._impl.isAutoRead||this._impl.unread++};var qe=function(e,t){this.toAccount=e,this.lastedMsgTime=t},Be=function(e,t,n,o,i,r,a){this.sess=e,this.type=a>=0?a:0,this.fromAccount=r,this.isSend=Boolean(t),this.seq=n>=0?n:J(r),this.random=o>=0?o:K(),this.time=i>=0?i:H(),this.elems=[]};Be.prototype.addText=function(t){this.addElem(new e.Msg.Elem(g,t))},Be.prototype.addFace=function(t){this.addElem(new e.Msg.Elem(I,t))},Be.prototype.addImage=function(t){this.addElem(new e.Msg.Elem(h,t))},Be.prototype.addCustom=function(t){this.addElem(new e.Msg.Elem(b,t))},Be.prototype.addPosition=function(t){this.addElem(new e.Msg.Elem(M,t))},Be.prototype.addElem=function(e){this.elems.push(e)},Be.prototype.toHtml=function(){var e="";for(var t in this.elems){var n=this.elems[t];e+=n.toHtml()}return e},Be.Elem=function(e,t){this.type=e,this.content=t},Be.Elem.prototype.toHtml=function(){var e;return e=this.content.toHtml()},Be.Elem.Position=function(e,t){this.data=e,this.index=t},Be.Elem.Position.prototype.getData=function(){return this.data},Be.Elem.Position.prototype.getDesc=function(){return this.desc},Be.Elem.Position.prototype.getExt=function(){return this.ext},Be.Elem.Position.prototype.toHtml=function(){return'<a src="//restapi.amap.com/v3/staticmap?scale=2&localtion='+this.data+","+this.index+"&zoom=15&size=200*200&markers=large,0xff0000,:"+this.data+","+this.index+'&key=dd5102328dd7e659348571462055b8b3" onclick="mapClick(this)">'},Be.Elem.Text=function(e){this.text=z.xssFilter(e)},Be.Elem.Text.prototype.getText=function(){return this.text},Be.Elem.Text.prototype.toHtml=function(){return this.text},Be.Elem.Face=function(e,t){this.index=e,this.data=t},Be.Elem.Face.prototype.getIndex=function(){return this.index},Be.Elem.Face.prototype.getData=function(){return this.data},Be.Elem.Face.prototype.toHtml=function(){return B[this.data]?"<a src='"+B[this.data]+"'/>":this.data},Be.Elem.Images=function(e){this.UUID=e,this.ImageInfoArray=[]},Be.Elem.Images.prototype.addImage=function(e){this.ImageInfoArray.push(e)},Be.Elem.Images.prototype.toHtml=function(){var e=this.getImage(T.SMALL),t=this.getImage(T.LARGE),n=this.getImage(T.ORIGIN);return t||(t=e),n||(n=e),"<a src='"+e.getUrl()+"#"+t.getUrl()+"#"+n.getUrl()+"' style='CURSOR: hand' id='"+this.getImageId()+"' bigImgUrl='"+t.getUrl()+"' onclick='imageClick(this)' />"},Be.Elem.Images.prototype.getImageId=function(){return this.UUID},Be.Elem.Images.prototype.getImage=function(e){for(var t in this.ImageInfoArray)if(this.ImageInfoArray[t].getType()==e)return this.ImageInfoArray[t];return null},Be.Elem.Images.Image=function(e,t,n,o,i){this.type=e,this.size=t,this.width=n,this.height=o,this.url=i},Be.Elem.Images.Image.prototype.getType=function(){return this.type},Be.Elem.Images.Image.prototype.getSize=function(){return this.size},Be.Elem.Images.Image.prototype.getWidth=function(){return this.width},Be.Elem.Images.Image.prototype.getHeight=function(){return this.height},Be.Elem.Images.Image.prototype.getUrl=function(){return this.url},Be.Elem.Sound=function(e,t,n,o,i){this.uuid=e,this.second=t,this.size=n,this.senderId=o,this.downUrl=i},Be.Elem.Sound.prototype.getUUID=function(){return this.uuid},Be.Elem.Sound.prototype.getSecond=function(){return this.second},Be.Elem.Sound.prototype.getSize=function(){return this.size},Be.Elem.Sound.prototype.getSenderId=function(){return this.senderId},Be.Elem.Sound.prototype.getDownUrl=function(){return this.downUrl},Be.Elem.Sound.prototype.toHtml=function(){return"ie"==n.type&&parseInt(n.ver)<=8?"[\u8fd9\u662f\u4e00\u6761\u8bed\u97f3\u6d88\u606f]demo\u6682\u4e0d\u652f\u6301ie8(\u542b)\u4ee5\u4e0b\u6d4f\u89c8\u5668\u64ad\u653e\u8bed\u97f3,\u8bed\u97f3URL:"+this.downUrl:'<audio src="'+this.downUrl+'" controls="controls" onplay="onChangePlayAudio(this)" preload="none"></audio>'},Be.Elem.File=function(e,t,n,o,i){this.uuid=e,this.name=t,this.size=n,this.senderId=o,this.downUrl=i},Be.Elem.File.prototype.getUUID=function(){return this.uuid},Be.Elem.File.prototype.getName=function(){return this.name},Be.Elem.File.prototype.getSize=function(){return this.size},Be.Elem.File.prototype.getSenderId=function(){return this.senderId},Be.Elem.File.prototype.getDownUrl=function(){return this.downUrl},Be.Elem.File.prototype.toHtml=function(){var e=Math.round(this.size/1024);return'<a href="'+this.downUrl+'" title="\u70b9\u51fb\u4e0b\u8f7d\u6587\u4ef6" ><i class="glyphicon glyphicon-file">&nbsp;'+this.name+"("+e+"KB)</i></a>"},Be.Elem.GroupTip=function(e,t,n,o,i){this.opType=e,this.opUserId=t,this.groupId=n,this.groupName=o,this.userIdList=i?i:[],this.groupInfoList=[],this.memberInfoList=[]},Be.Elem.GroupTip.prototype.addGroupInfo=function(e){this.groupInfoList.push(e)},Be.Elem.GroupTip.prototype.addMemberInfo=function(e){this.memberInfoList.push(e)},Be.Elem.GroupTip.prototype.getOpType=function(){return this.opType},Be.Elem.GroupTip.prototype.getOpUserId=function(){return this.opUserId},Be.Elem.GroupTip.prototype.getGroupId=function(){return this.groupId},Be.Elem.GroupTip.prototype.getGroupName=function(){return this.groupName},Be.Elem.GroupTip.prototype.getUserIdList=function(){return this.userIdList},Be.Elem.GroupTip.prototype.getGroupInfoList=function(){return this.groupInfoList},Be.Elem.GroupTip.prototype.getMemberInfoList=function(){return this.memberInfoList},Be.Elem.GroupTip.prototype.toHtml=function(){var e="[\u7fa4\u63d0\u793a\u6d88\u606f]",t=k-1;switch(this.opType){case C.JOIN:e+=this.opUserId+"\u9080\u8bf7\u4e86";for(var n in this.userIdList)if(e+=this.userIdList[n]+",",this.userIdList.length>k&&n==t){e+="\u7b49"+this.userIdList.length+"\u4eba";break}e+="\u52a0\u5165\u8be5\u7fa4";break;case C.QUIT:e+=this.opUserId+"\u4e3b\u52a8\u9000\u51fa\u8be5\u7fa4";break;case C.KICK:e+=this.opUserId+"\u5c06";for(var n in this.userIdList)if(e+=this.userIdList[n]+",",this.userIdList.length>k&&n==t){e+="\u7b49"+this.userIdList.length+"\u4eba";break}e+="\u8e22\u51fa\u8be5\u7fa4";break;case C.SET_ADMIN:e+=this.opUserId+"\u5c06";for(var n in this.userIdList)if(e+=this.userIdList[n]+",",this.userIdList.length>k&&n==t){e+="\u7b49"+this.userIdList.length+"\u4eba";break}e+="\u8bbe\u4e3a\u7ba1\u7406\u5458";break;case C.CANCEL_ADMIN:e+=this.opUserId+"\u53d6\u6d88";for(var n in this.userIdList)if(e+=this.userIdList[n]+",",this.userIdList.length>k&&n==t){e+="\u7b49"+this.userIdList.length+"\u4eba";break}e+="\u7684\u7ba1\u7406\u5458\u8d44\u683c";break;case C.MODIFY_GROUP_INFO:e+=this.opUserId+"\u4fee\u6539\u4e86\u7fa4\u8d44\u6599\uff1a";for(var n in this.groupInfoList){var o=this.groupInfoList[n].getType(),i=this.groupInfoList[n].getValue();switch(o){case G.FACE_URL:e+="\u7fa4\u5934\u50cf\u4e3a"+i+"; ";break;case G.NAME:e+="\u7fa4\u540d\u79f0\u4e3a"+i+"; ";break;case G.OWNER:e+="\u7fa4\u4e3b\u4e3a"+i+"; ";break;case G.NOTIFICATION:e+="\u7fa4\u516c\u544a\u4e3a"+i+"; ";break;case G.INTRODUCTION:e+="\u7fa4\u7b80\u4ecb\u4e3a"+i+"; ";break;default:e+="\u672a\u77e5\u4fe1\u606f\u4e3a:type="+o+",value="+i+"; "}}break;case C.MODIFY_MEMBER_INFO:e+=this.opUserId+"\u4fee\u6539\u4e86\u7fa4\u6210\u5458\u8d44\u6599:";for(var n in this.memberInfoList){var r=this.memberInfoList[n].getUserId(),a=this.memberInfoList[n].getShutupTime();if(e+=r+": ",e+=null!=a&&void 0!==a?0==a?"\u53d6\u6d88\u7981\u8a00; ":"\u7981\u8a00"+a+"\u79d2; ":" shutupTime\u4e3a\u7a7a",this.memberInfoList.length>k&&n==t){e+="\u7b49"+this.memberInfoList.length+"\u4eba";break}}break;default:e+="\u672a\u77e5\u7fa4\u63d0\u793a\u6d88\u606f\u7c7b\u578b\uff1atype="+this.opType}return e},Be.Elem.GroupTip.GroupInfo=function(e,t){this.type=e,this.value=t},Be.Elem.GroupTip.GroupInfo.prototype.getType=function(){return this.type},Be.Elem.GroupTip.GroupInfo.prototype.getValue=function(){return this.value},Be.Elem.GroupTip.MemberInfo=function(e,t){this.userId=e,this.shutupTime=t},Be.Elem.GroupTip.MemberInfo.prototype.getUserId=function(){return this.userId},Be.Elem.GroupTip.MemberInfo.prototype.getShutupTime=function(){return this.shutupTime},Be.Elem.Custom=function(e,t,n){this.data=e,this.desc=t,this.ext=n},Be.Elem.Custom.prototype.getData=function(){return this.data},Be.Elem.Custom.prototype.getDesc=function(){return this.desc},Be.Elem.Custom.prototype.getExt=function(){return this.ext},Be.Elem.Custom.prototype.toHtml=function(){return this.data};var ze=new function(){var e={},t=[],n={};this.cookie="",this.syncFlag=0;var o=function(t){for(var n in e)t(e[n])},i=function(e){var t=!1,o=e.sess._impl.skey,i=e.isSend+e.seq+e.random,r=n[o]&&n[o][i];return r&&Math.abs(e.time-r.time)<1800&&(t=!0),n[o]?n[o][i]={time:e.time}:(n[o]={},n[o][i]={time:e.time}),t};this.sessMap=function(){return t},this.sessCount=function(){return t.length},this.sessByTypeId=function(t,n){var o=Pe.skey(t,n);return"undefined"===o||null==o?null:e[o]},this.delSessByTypeId=function(t,o){var i=Pe.skey(t,o);return"undefined"===i||null==i?!1:(e[i]&&(delete e[i],delete n[i]),!0)},this.resetCookieAndSyncFlag=function(){this.cookie="",this.syncFlag=0},this.setAutoRead=function(e,t,n){if(n&&o(function(e){e._impl.isAutoRead=!1}),e&&(e._impl.isAutoRead=t,t))if(e._impl.unread=0,e._impl.type==l){var i=[];i.push(new qe(e._impl.id,e._impl.time)),ne(ze.cookie,i,function(e){},function(e){})}else if(e._impl.type==p){var r={GroupId:e._impl.id,MsgReadedSeq:e._impl.curMaxMsgSeq};be(r,function(e){},function(e){})}},this.c2CMsgReaded=function(e,t,n){var o=[];o.push(new qe(e.To_Account,e.LastedMsgTime)),ne(ze.cookie,o,function(e){t&&t(e)},function(e){n&&n(e)})},this.addSession=function(t){
    e[t._impl.skey]=t},this.delSession=function(t){delete e[t._impl.skey]},this.addMsg=function(t){if(i(t))return!1;var n=t.sess;return e[n._impl.skey]||this.addSession(n),n._impl_addMsg(t),!0},this.updateTimeline=function(){var e=new Array;o(function(t){e.push(t)}),e.sort(function(e,t){return t.time-e.time}),t=e}},He=new function(){var e=null,t=null,o={1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,255:null},i=0,r=0,a=[],s=null,u=null,c=0,f={},m={},d=function(e,t){Ne(function(e){a=e.IpList,s=e.AuthKey,u=e.ExpireTime},function(e){t&&t(e)})},T=function(e,t,n){var o={Member_Account:e.identifier,Limit:1e3,Offset:0,GroupBaseInfoFilter:["NextMsgSeq"]};Ie(o,function(e){if(e.GroupIdList&&0!=e.GroupIdList.length)for(var t=0;t<e.GroupIdList.length;t++){var n=e.GroupIdList[t].GroupId,o=e.GroupIdList[t].NextMsgSeq-1;f[n]=o}},function(e){n&&n(e)})},k=function(e,t,n){c++;var o={GroupId:e,ReqMsgSeq:t,ReqMsgNumber:n};He.syncGroupMsgs(o)},L=function(e,t){for(var n in e){var o=e[n];if(o.From_Account&&o.From_Account!=O.identifier){var i=P(o.ToGroupId,o);i&&t.push(i)}}return t},w=function(t,n){var o={},i=[],a=99999999,s=-1;for(var u in n){var c=o[n[u].ToGroupId];c||(c=o[n[u].ToGroupId]={min:a,max:s,msgs:[]}),n[u].NoticeSeq>r&&(r=n[u].NoticeSeq),n[u].Event=t,o[n[u].ToGroupId].msgs.push(n[u]),n[u].MsgSeq<c.min&&(o[n[u].ToGroupId].min=n[u].MsgSeq),n[u].MsgSeq>c.max&&(o[n[u].ToGroupId].max=n[u].MsgSeq)}for(var l in o){var p=o[l].max-o[l].min+1,m=f[l];m?o[l].min-m>1||o[l].msgs.length<p?k(l,o[l].max,o[l].max-m):i=L(o[l].msgs,i):o[l].msgs.length<p?k(l,o[l].max,p):i=L(o[l].msgs,i)}i.length&&ze.updateTimeline(),e&&i.length&&e(i)},N=function(e){for(var t in e){var n=e[t],i=n.MsgBody,a=i.ReportType;n.NoticeSeq>r&&(r=n.NoticeSeq);var s=n.GroupInfo.To_Account;if(s&&s==O.identifier){var u=n.ToGroupId+"_"+a+"_"+n.MsgTimeStamp+"_"+i.Operator_Account,c=m[u];if(!c){m[u]=!0;var l={ReportType:a,GroupId:n.ToGroupId,GroupName:n.GroupInfo.GroupName,Operator_Account:i.Operator_Account,MsgTime:n.MsgTimeStamp};switch(a){case F.JOIN_GROUP_REQUEST:l.RemarkInfo=i.RemarkInfo,l.MsgKey=i.MsgKey,l.Authentication=i.Authentication,l.UserDefinedField=n.UserDefinedField,l.From_Account=n.From_Account,l.MsgSeq=n.ClientSeq,l.MsgRandom=n.MsgRandom;break;case F.JOIN_GROUP_ACCEPT:case F.JOIN_GROUP_REFUSE:l.RemarkInfo=i.RemarkInfo;break;case F.KICK:case F.DESTORY:case F.CREATE:case F.INVITED_JOIN_GROUP_REQUEST:case F.QUIT:case F.SET_ADMIN:case F.CANCEL_ADMIN:case F.REVOKE:break;case F.CUSTOM:l.UserDefinedField=i.UserDefinedField}o[a]&&o[a](l)}}}},D=function(e,t){var n={Timeout:90,Cookie:{NotifySeq:i,NoticeSeq:r}};ee(n,function(e){for(var t in e.EventArray){var n=e.EventArray[t];switch(n.Event){case S.C2C:i=n.NotifySeq,He.syncMsgs();break;case S.GROUP_ORDINARY:w(n.Event,n.GroupMsgArray);break;case S.GROUP_TIP:w(n.Event,n.GroupTips);break;case S.GROUP_SYSTEM:N(n.GroupTips)}}D()},function(e){60003==e.ErrorCode&&R++,U>R&&D(),t&&t(e)})};this.closeLongPolling=function(){D()},this.openLongPolling=function(){D()};var x=function(e){for(var t in e){var n=e[t];switch(n.Event){case S.GROUP_SYSTEM:N(n.GroupTips)}}};this.syncMsgs=function(t,n){var o=[],i=[];te(ze.cookie,ze.syncFlag,function(n){2==n.SyncFlag&&(ze.syncFlag=0),i=n.MsgList,ze.cookie=n.Cookie;for(var r in i){var a,s,u,c=i[r];c.From_Account==O.identifier?(a=!0,s=c.To_Account,u=""):(a=!1,s=c.From_Account,u="");var p=ze.sessByTypeId(l,s);p||(p=new Pe(l,s,s,u,0,0));var f=new Be(p,a,c.MsgSeq,c.MsgRandom,c.MsgTimeStamp,c.From_Account),m=null,d=null,A=null;for(var T in c.MsgBody){switch(m=c.MsgBody[T],A=m.MsgType){case g:d=new Be.Elem.Text(m.MsgContent.Text);break;case I:d=new Be.Elem.Face(m.MsgContent.Index,m.MsgContent.Data);break;case h:d=new Be.Elem.Images(m.MsgContent.UUID);for(var E in m.MsgContent.ImageInfoArray){var v=m.MsgContent.ImageInfoArray[E];d.addImage(new Be.Elem.Images.Image(v.Type,v.Size,v.Width,v.Height,v.URL))}break;case _:var S=q(m.MsgContent.UUID,c.From_Account);S?d=new Be.Elem.Sound(m.MsgContent.UUID,m.MsgContent.Second,m.MsgContent.Size,c.From_Account,S):(A=g,d=new Be.Elem.Text("[\u8bed\u97f3\u6d88\u606f]\u4e0b\u8f7d\u5730\u5740\u89e3\u6790\u51fa\u9519"));break;case M:var C=m.MsgContent.Latitude,G=m.MsgContent.Longitude;d=new Be.Elem.Position(C,G);break;case y:case y+" ":var F=B(m.MsgContent.UUID,c.From_Account,m.MsgContent.FileName);F?d=new Be.Elem.File(m.MsgContent.UUID,m.MsgContent.FileName,m.MsgContent.FileSize,c.From_Account,F):(A=g,d=new Be.Elem.Text("[\u6587\u4ef6\u6d88\u606f\u4e0b\u8f7d\u5730\u5740\u89e3\u6790\u51fa\u9519]"));break;case b:A=b,d=new Be.Elem.Custom(m.MsgContent.Data,m.MsgContent.Desc,m.MsgContent.Ext);break;default:A=g,d=new Be.Elem.Text("web\u7aef\u6682\u4e0d\u652f\u6301"+m.MsgType+"\u6d88\u606f")}f.elems.push(new Be.Elem(A,d))}ze.addMsg(f)&&o.push({msg:f})}x(n.EventArray),o.length>0&&ze.updateTimeline(),t?t(o):o.length>0&&e&&e(o)},function(e){n&&n(e)})},this.syncGroupMsgs=function(t,n,o){if(!(t.ReqMsgSeq<=0)){var i={GroupId:t.GroupId,ReqMsgSeq:t.ReqMsgSeq,ReqMsgNumber:t.ReqMsgNumber};Me(i,function(t){var o=[],i=t.GroupId,r=t.RspMsgList;if(null!=r&&void 0!=r){for(var a=r.length-1;a>=0;a--){var s=r[a];if(!s.IsPlaceMsg&&s.From_Account&&s.MsgBody){var u=P(i,s);u&&o.push({msg:u})}}o.length>0&&ze.updateTimeline(),n?n(o):o.length>0&&e&&e(o)}},function(e){o&&o(e)})}};var P=function(e,n){var o,i,r;n.From_Account==O.identifier?(o=!0,i=n.From_Account,r=""):(o=!1,i=n.From_Account,r="");var a=ze.sessByTypeId(p,e);a||(a=new Pe(p,e,e,r,0,0));var s=0;if(4==n.Event){s=1;var u=n.MsgBody;n.MsgBody=[],n.MsgBody.push({MsgType:A,MsgContent:u})}var c=new Be(a,o,n.MsgSeq,n.MsgSeq,n.MsgTimeStamp,n.From_Account,s),l=null,m=null,d=null;for(var T in n.MsgBody){switch(l=n.MsgBody[T],d=l.MsgType){case g:m=new Be.Elem.Text(l.MsgContent.Text);break;case I:m=new Be.Elem.Face(l.MsgContent.Index,l.MsgContent.Data);break;case h:m=new Be.Elem.Images(l.MsgContent.UUID);for(var E in l.MsgContent.ImageInfoArray)m.addImage(new Be.Elem.Images.Image(l.MsgContent.ImageInfoArray[E].Type,l.MsgContent.ImageInfoArray[E].Size,l.MsgContent.ImageInfoArray[E].Width,l.MsgContent.ImageInfoArray[E].Height,l.MsgContent.ImageInfoArray[E].URL));break;case _:var v=q(l.MsgContent.UUID,n.From_Account);v?m=new Be.Elem.Sound(l.MsgContent.UUID,l.MsgContent.Second,l.MsgContent.Size,n.From_Account,v):(d=g,m=new Be.Elem.Text("[\u8bed\u97f3\u6d88\u606f]\u4e0b\u8f7d\u5730\u5740\u89e3\u6790\u51fa\u9519"));break;case M:d=g,m=new Be.Elem.Text("web\u7aef\u6682\u4e0d\u652f\u6301\u5730\u7406\u4f4d\u7f6e\u6d88\u606f");break;case y:case y+" ":var S=B(l.MsgContent.UUID,n.From_Account,l.MsgContent.FileName);S?m=new Be.Elem.File(l.MsgContent.UUID,l.MsgContent.FileName,l.MsgContent.FileSize,n.From_Account,S):(d=g,m=new Be.Elem.Text("[\u6587\u4ef6\u6d88\u606f]\u5730\u5740\u89e3\u6790\u51fa\u9519"));break;case A:var F=l.MsgContent.OpType;if(m=new Be.Elem.GroupTip(F,l.MsgContent.Operator_Account,e,n.GroupInfo.GroupName,l.MsgContent.List_Account),C.MODIFY_GROUP_INFO==F){var k=!1,R={GroupId:e,GroupFaceUrl:null,GroupName:null,OwnerAccount:null,GroupNotification:null,GroupIntroduction:null},U=l.MsgContent.MsgGroupNewInfo;if(U.GroupFaceUrl){var L=new Be.Elem.GroupTip.GroupInfo(G.FACE_URL,U.GroupFaceUrl);m.addGroupInfo(L),k=!0,R.GroupFaceUrl=U.GroupFaceUrl}if(U.GroupName){var w=new Be.Elem.GroupTip.GroupInfo(G.NAME,U.GroupName);m.addGroupInfo(w),k=!0,R.GroupName=U.GroupName}if(U.Owner_Account){var N=new Be.Elem.GroupTip.GroupInfo(G.OWNER,U.Owner_Account);m.addGroupInfo(N),k=!0,R.OwnerAccount=U.Owner_Account}if(U.GroupNotification){var D=new Be.Elem.GroupTip.GroupInfo(G.NOTIFICATION,U.GroupNotification);m.addGroupInfo(D),k=!0,R.GroupNotification=U.GroupNotification}if(U.GroupIntroduction){var x=new Be.Elem.GroupTip.GroupInfo(G.INTRODUCTION,U.GroupIntroduction);m.addGroupInfo(x),k=!0,R.GroupIntroduction=U.GroupIntroduction}k&&t&&t(R)}else if(C.MODIFY_MEMBER_INFO==F){var P=l.MsgContent.MsgMemberInfo;for(var z in P){var H=P[z];m.addMemberInfo(new Be.Elem.GroupTip.MemberInfo(H.User_Account,H.ShutupTime))}}break;case b:d=b,m=new Be.Elem.Custom(l.MsgContent.Data,l.MsgContent.Desc,l.MsgContent.Ext);break;default:d=g,m=new Be.Elem.Text("web\u7aef\u6682\u4e0d\u652f\u6301"+l.MsgType+"\u6d88\u606f")}c.elems.push(new Be.Elem(d,m))}if(ze.addMsg(c)){var J=f[e];return J?n.MsgSeq>J&&(f[e]=n.MsgSeq):f[e]=n.MsgSeq,c}return null};this.init=function(i,r,a,s){return e=i,t=r,o=a,n=z.getBrowserInfo(),"ie"==n.type&&parseInt(n.ver)<8?void alert("\u60a8\u7684ie\u7248\u672c\u8fc7\u4f4e\uff0c\u5efa\u8bae\u4f7f\u7528ie8\u4ee5\u4e0a\u6d4f\u89c8\u5668^_^"):(T(s),void d())},this.sendMsg=function(e,t,n){Z(e,function(o){if(e.sess.type()==l){if(!ze.addMsg(e)){var i="sendMsg: local addMsg failed!",r=z.getReturnError(i);return void(n&&n(r))}ze.updateTimeline()}t&&t(o)},function(e){n&&n(e)})};var q=function(e,t){var n=null;return s&&a[0]&&(n="http://"+a[0]+"/asn.com/stddownload_common_file?authkey="+s+"&bid="+E+"&subbid="+O.appIDAt3rd+"&fileid="+e+"&filetype="+v.SOUND+"&openid="+t+"&ver=0"),n},B=function(e,t,n){var o=null;return s&&a[0]&&(o="http://"+a[0]+"/asn.com/stddownload_common_file?authkey="+s+"&bid="+E+"&subbid="+O.appIDAt3rd+"&fileid="+e+"&filetype="+v.FILE+"&openid="+t+"&ver=0&filename="+encodeURIComponent(n)),o}},Je=new function(){this.fileMd5=null;var e=function(e,t,n){function o(){var t=c*s,n=t+s>=e.size?e.size:t+s,o=a.call(e,t,n);i.readAsArrayBuffer(o)}var i=null;try{i=new FileReader}catch(r){if(n)return void n(z.getReturnError("\u5f53\u524d\u6d4f\u89c8\u5668\u4e0d\u652f\u6301FileReader"))}var a=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice;if(!a&&n)return void n(z.getReturnError("\u5f53\u524d\u6d4f\u89c8\u5668\u4e0d\u652f\u6301FileAPI"));var s=2097152,u=Math.ceil(e.size/s),c=0,l=new SparkMD5;i.onload=function(e){for(var n="",i=new Uint8Array(e.target.result),r=i.byteLength,a=0;r>a;a++)n+=String.fromCharCode(i[a]);l.appendBinary(n),c++,u>c?o():(this.fileMd5=l.end(),t&&t(this.fileMd5))},o()};this.uploadFile=function(t,n,o){var i={init:function(e,t,n){var o=this;o.file=e.file,o.onProgressCallBack=e.onProgressCallBack,e.abortButton&&(e.abortButton.onclick=o.abortHandler),o.total=o.file.size,o.loaded=0,o.step=122880,o.sliceSize=0,o.sliceOffset=0,o.timestamp=H(),o.seq=J(e.From_Account),o.random=K(),o.fromAccount=e.From_Account,o.toAccount=e.To_Account,o.fileMd5=e.fileMd5,o.businessType=e.businessType,o.cbOk=t,o.cbErr=n,o.reader=new FileReader,o.blobSlice=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice,o.reader.onloadstart=o.onLoadStart,o.reader.onprogress=o.onProgress,o.reader.onabort=o.onAbort,o.reader.onerror=o.onerror,o.reader.onload=o.onLoad,o.reader.onloadend=o.onLoadEnd},upload:function(){var e=i;e.readBlob(0)},onLoadStart:function(){},onProgress:function(e){var t=i;t.loaded+=e.loaded,t.onProgressCallBack&&t.onProgressCallBack(t.loaded,t.total)},onAbort:function(){},onError:function(){},onLoad:function(e){var t=i;if(e.target.readyState==FileReader.DONE){var n=e.target.result,o=n.indexOf(",");-1!=o&&(n=n.substr(o+1));var r={From_Account:t.fromAccount,To_Account:t.toAccount,Busi_Id:t.businessType,File_Str_Md5:t.fileMd5,PkgFlag:1,File_Size:t.total,Slice_Offset:t.sliceOffset,Slice_Size:t.sliceSize,Slice_Data:n,Seq:t.seq,Timestamp:t.timestamp,Random:t.random};we(r,function(e){if(0==e.IsFinish)t.loaded=e.Next_Offset,t.loaded<t.total?t.readBlob(t.loaded):t.loaded=t.total;else if(t.cbOk){var n={ActionStatus:e.ActionStatus,ErrorCode:e.ErrorCode,ErrorInfo:e.ErrorInfo,File_UUID:e.File_UUID,URL_INFO:e.URL_INFO};t.cbOk(n)}},t.cbErr)}},onLoadEnd:function(){},readBlob:function(e){var t,n=i,o=n.file,r=e+n.step;r>n.total?(r=n.total,n.sliceSize=r-e):n.sliceSize=n.step,n.sliceOffset=e,t=n.blobSlice.call(o,e,r),n.reader.readAsDataURL(t)},abortHandler:function(){var e=i;e.reader&&e.reader.abort()}};e(t.file,function(e){t.fileMd5=e,i.init(t,n,o),i.upload()},o)}},Ke=!0;e.init=function(e,t,n){O.sdkAppID=e.sdkAppID,O.appIDAt3rd=e.appIDAt3rd,O.identifier=e.identifier,O.accountType=e.accountType,O.userSig=e.userSig,t.jsonpCallback&&(N=t.jsonpCallback),n&&(D=n),xe.init(t.onConnNotify),He.init(t.onMsgNotify,t.onGroupInfoChangeNotify,t.groupSystemNotifys,e)},e.Tool=z,e.EmotionPicData=B,e.EmotionPicDataIndex=q,e.Msg=Be,e.Session=Pe,e.MsgStore={sessMap:function(){return ze.sessMap()},sessCount:function(){return ze.sessCount()},sessByTypeId:function(e,t){return ze.sessByTypeId(e,t)},delSessByTypeId:function(e,t){return ze.delSessByTypeId(e,t)},resetCookieAndSyncFlag:function(){return ze.resetCookieAndSyncFlag()}},e.openLong=function(){return Ke=!0,He.openLongPolling()},e.closeLong=function(){return Ke=!1,He.closeLongPolling()},e.setAutoRead=function(e,t,n){return ze.setAutoRead(e,t,n)},e.offline=function(e,t){return X(e,t)},e.sendMsg=function(e,t,n){return He.sendMsg(e,t,n)},e.syncMsgs=function(e,t){return He.syncMsgs(e,t)},e.syncGroupMsgs=function(e,t,n){return He.syncGroupMsgs(e,t,n)},e.c2CMsgReaded=function(e,t,n){return ze.c2CMsgReaded(e,t,n)},e.groupMsgReaded=function(e,t,n){return be(e,t,n)},e.createGroup=function(e,t,n){return ie(e,t,n)},e.applyJoinGroup=function(e,t,n){return ae(e,t,n)},e.handleApplyJoinGroupPendency=function(e,t,n){return se(e,t,n)},e.deleteApplyJoinGroupPendency=function(e,t,n){return oe(e,t,n)},e.quitGroup=function(e,t,n){return ue(e,t,n)},e.getGroupPublicInfo=function(e,t,n){return ce(e,t,n)},e.getGroupInfo=function(e,t,n){return le(e,t,n)},e.modifyGroupBaseInfo=function(e,t,n){return re(e,t,n)},e.getGroupMemberInfo=function(e,t,n){return pe(e,t,n)},e.addGroupMember=function(e,t,n){return fe(e,t,n)},e.modifyGroupMember=function(e,t,n){return me(e,t,n)},e.deleteGroupMember=function(e,t,n){return de(e,t,n)},e.destroyGroup=function(e,t,n){return ge(e,t,n)},e.getJoinedGroupListHigh=function(e,t,n){return Ie(e,t,n)},e.getRoleInGroup=function(e,t,n){return he(e,t,n)},e.forbidSendMsg=function(e,t,n){return _e(e,t,n)},e.sendCustomGroupNotify=function(e,t,n){return ye(e,t,n)},e.getProfilePortrait=function(e,t,n){return Fe(e,t,n)},e.setProfilePortrait=function(e,t,n){return ke(e,t,n)},e.applyAddFriend=function(e,t,n){return Te(e,t,n)},e.getPendency=function(e,t,n){return ve(e,t,n)},e.deletePendency=function(e,t,n){return Se(e,t,n)},e.responseFriend=function(e,t,n){return Ce(e,t,n)},e.getAllFriend=function(e,t,n){return Ge(e,t,n)},e.deleteFriend=function(e,t,n){return Ee(e,t,n)},e.addBlackList=function(e,t,n){return Re(e,t,n)},e.deleteBlackList=function(e,t,n){return Ue(e,t,n)},e.getBlackList=function(e,t,n){return Le(e,t,n)},e.uploadPic=function(e,t,n){return Je.uploadFile(e,t,n)},e.setJsonpLastRspData=function(e){w="string"==typeof e?JSON.parse(e):e}}(webim);